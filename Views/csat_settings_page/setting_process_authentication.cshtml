
@{
    ViewData["Title"] = "setting_process_authentication";
    Layout = "~/Views/Shared/ownyit_main_page.cshtml";
}
<script src="~/js/main.js"></script>
<script type="text/javascript">
    $(document).ready(function () {
        $('.process_authentication').DataTable({
            paging: true,
            order: [],
            columnDefs: [{ orderable: false }],
            searching: false,
            info: false,
            responsive: false,

        });
        $(".table").css({ "width": "100%" });
        $(".dataTables_scrollHeadInner ").css({ "width": "100%" });

    });

</script>
<body onload="DataBind()">
    <div class="row">

        <div class="ibox float-e-margins ">
            <div class="ibox-content" style="padding:4px;">
                <ul class="breadcrumb" style="margin-bottom:0px;">
                    <li>
                        @Html.ActionLink("Settings", "setting_scan_ip_range", "csat_settings_page")
                        <i class="icon-angle-right"></i>
                    </li>
                    <li>Process Authentication Detail</li>
                </ul>
            </div>
        </div>

        <!--side menu-->
        <div class="col-sm-2 col-md-2 col-lg-2 no_padding">
            <div class="ibox float-e-margins ">
                <div class="ibox-content sidemenu">
                    @{
                        @Html.Partial("csat_settings_page_menu");
                    }
                </div>
            </div>
        </div>
        <!--side menu end-->

        <div class="col-sm-10 col-md-10 col-lg-10">
            <!--BackSide Generate white form color-->
            <div class="ibox float-e-margins" style="margin-bottom: 10px;display:none">
                <div class="ibox-content">
                    <div class="row">
                        <div class="col-sm-12 col-md-12 col-lg-12">

                            <div class="row">
                                <div class="col-xs-12">
                                    <form class="form-horizontal" method="post">
                                        <div class="form-group">
                                            <label for="nameField" style="margin-top: -5px;background-color: #fff;text-align: center;color: #3D93C8;width: 120px;" class="col-xs-2 form_label">&nbsp;&nbsp;Advance Search&nbsp;&nbsp;</label>
                                            <div class="col-xs-10">
                                            </div>
                                        </div>

                                    </form>
                                </div>
                            </div>
                        </div>

                    </div>
                    <!--BackSide Generate white form over-->

                    <div class="row">
                        <div class="col-xs-12">
                            <form class="form-horizontal" method="post" id="frm_setting_process_auth_search" name="frm_setting_process_auth_search">
                                <div class="form-group">
                                    <label for="nameField" class="col-xs-1 form_label">Process Name</label>
                                    <div class="col-xs-4">
                                        <div class="input-group">
                                            <input type="search" class="form-control" placeholder="Search" id="txtsearch" name="txtsearch">
                                            <div class="input-group-btn">
                                                <button class="btn btn-default " type="button" onclick="DataBind()">
                                                    <i class="glyphicon glyphicon-search"></i>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                    <!--process Authentication Detail Datatable start-->
                </div>
            </div>
            <div class="row ibox2">
                <div class="col-sm-12 col-md-12 col-lg-12 ibox2-content">
                    <div class="table-responsive" id="div_process_main_data">
                    </div>
                </div>
            </div>
            <!--process Authentication Detail Datatable End-->

        </div>
        <div class="space_bottom">
            &nbsp;
        </div>

    </div>
</body>
<script>
    $(document).ready(function () {
        validateSingleForm("#frm_setting_process_auth_search");
    });
</script>


<script>

    $(".parent").each(function (index) {
        var group = $(this).data("group");
        var parent = $(this);

        parent.change(function () {  //"select all" change
            $(group).prop('checked', parent.prop("checked"));
        });
        $(group).change(function () {
            parent.prop('checked', false);
            if ($(group + ':checked').length == $(group).length) {
                parent.prop('checked', true);
            }
        });
    });

    $.get(null, null, DataBind);

    function DataBind() {
        var $valid = $('#frm_setting_process_auth_search').valid();
        if (!$valid) {
            $validatorform.focusInvalid();
            return false;
        }
        else {

            $("#overlay").show();
            $("#overlay").fadeIn(300);
            var searchvalue = document.getElementById("txtsearch").value;
            var url1 = '@Url.Content("~/csat_settings_page/csat_process_authentication_data?strsearch=")' + searchvalue;
            $.ajax({
                type: "POST",
                url: url1,
                success: function (data) {
                    //  debugger;
                    var SetProcessData = $('#div_process_main_data');
                    jQuery('#div_process_main_data').html('');
                    //var csat_process_auth_data = "<table class='table table-striped table-bordered process_authentication' style='width:100%'><thead><tr><th class='select' data-orderable='false'><input type='checkbox' class='parent' data-group='.group3' id='chk_process_main_data' onclick='checkallitems(this,this.id);' /></th><th class='col-sm-5'>Process Name</th><th class='col-sm-3'>Process Description</th><th class='col-sm-2 icon ' data-orderable='false'>White List</th><th class='col-sm-2 icon' data-orderable='false'>Black List</th></tr></thead><tbody>";
                    var csat_process_auth_data = "<table class='table table-striped table-bordered tblpaging' style='width:100%'><thead><tr><th class='col-sm-5'>Process Name</th><th class='col-sm-3'>Process Description</th><th data-orderable='false' class='col-sm-1'>Manage</th></tr></thead><tbody>";
                    for (var i = 0; i < data.csat_process_auth_data.length; i++) {
                        csat_process_auth_data += "<tr>";
                        //if (data.csat_process_auth_data[i].authorize == "0" || data.csat_process_auth_data[i].authorize == "1") {
                        //    csat_process_auth_data += "<td class='select'><input type='checkbox' class='group3' name='check[]' id='chk_process_main_data' checked='checked' value='" + data.csat_process_auth_data[i].process_name + "' /></td>";
                        //}
                        //else {
                        //    csat_process_auth_data += "<td class='select'><input type='checkbox' class='group3' name='check[]' id='chk_process_main_data' value='" + data.csat_process_auth_data[i].process_name + "' /></td>";
                        //}
                        csat_process_auth_data += "<td class='col-sm-5'>" + data.csat_process_auth_data[i].process_name + "</td>";
                        csat_process_auth_data += "<td class='col-sm-3'>" + data.csat_process_auth_data[i].process_desc + "</td>";

                        csat_process_auth_data += "<td class='col-sm-1 icon_center' data-orderable='false'><div class='dropdown'><i class='dropdown-toggle glyphicon glyphicon-pencil manage_icon' type='button' data-toggle='dropdown'></i>";
                        csat_process_auth_data += "<ul class='dropdown-menu' style='min-width: 120px;'><li style='text-align: left;'><a href='#' onclick=ProcessAction('','" + encodeURIComponent(data.csat_process_auth_data[i].process_name) + "','Authorise')>Authorise</a></li>";
                        csat_process_auth_data += "<li style='text-align: left;'><a href='#' onclick=ProcessAction('','" + encodeURIComponent(data.csat_process_auth_data[i].process_name) + "','UnAuthorise')>Unauthorise</a></li></ul></div></td>";
                        //if (data.csat_process_auth_data[i].authorize == "1") {
                        //    csat_process_auth_data += "<td class='col-sm-2 icon'><div class='radio'><label> <input type='radio' checked='checked' id='rd" + i + "w' name='list" + i + "' value='Whitelist' /></label></div></td>";
                        //}
                        //else {
                        //    csat_process_auth_data += "<td class='col-sm-2 icon'><div class='radio'><label> <input type='radio' id='rd" + i + "w' name='list" + i + "'  value='Whitelist' /></label></div></td>";
                        //}
                        //if (data.csat_process_auth_data[i].authorize == "0") {
                        //    csat_process_auth_data += "<td class='col-sm-2 icon'><div class='radio'><label> <input type='radio' id='rd" + i + "b' checked='checked' name='list" + i + "' value='Blacklist' /></label></div></td>";
                        //}
                        //else {
                        //    csat_process_auth_data += "<td class='col-sm-2 icon'><div class='radio'><label> <input type='radio' id='rd" + i + "b' name='list" + i + "' value='Blacklist' /></label></div></td>";
                        //}
                        csat_process_auth_data += "</tr >";
                    }
                    csat_process_auth_data += "</tbody></table>";

                    SetProcessData.append(csat_process_auth_data);
                    datatable_paging();

                }
            }).done(function () {
                setTimeout(function () {
                    $("#overlay").fadeOut(300);
                }, 500);
            });
        }
    }
    function apply_process_auth() {
        //debugger;
        var process_selected_value = "";
        var process_not_selected = "";
        var checkboxes = document.querySelectorAll('input[id="chk_process_main_data"]');
        for (var i = 1; i < checkboxes.length; i++) {
            if (checkboxes[i].checked == true) {
                process_selected_value += "," + checkboxes[i].value;
                var rdname = "list" + (i - 1).toString();
                var selected = document.getElementsByName(rdname);
                if (selected[0].checked) {
                    process_selected_value += ":1";
                }
                else if (selected[1].checked) {
                    process_selected_value += ":0";
                }
            }
            else {
                process_not_selected += "," + checkboxes[i].value;
            }
        }
        //alert(process_selected_value);
        //alert(process_not_selected);
        var url1 = '@Url.Content("~/csat_settings_page/csat_process_authentication_apply?process_selected_value=")' + process_selected_value + '&process_not_selected=' + process_not_selected;
        $.ajax({
            type: "POST",
            url: url1,
            success: function (data) {
                alert(data);
            }
        });
        document.getElementById("txtsearch").value = '';
        DataBind();
    }

    // new process unauth//auth code
    function ProcessAction(Id, name, type) {
         if (confirm("Are you sure want to " + type+"?")) {
             if (type == "Authorise")
                 type = "WHITELIST";
             else
                 type = "BLACKLIST";
            var url = '@Url.Content("~/csat_settings_page/ProcessAction?process=")'  + decodeURIComponent(name) + '&ActionType=' + type;
        $.ajax({
            type: "POST",
            url: url,
            success: function (data) {

                window.location.href = '@Url.Content("~/csat_settings_page/setting_process_authentication")';
            }
        });
        } else {
        }
        document.getElementById("txtsearch").value = '';
        DataBind();
    }

</script>

