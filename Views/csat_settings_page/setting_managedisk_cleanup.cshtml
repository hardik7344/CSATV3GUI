
@{
    ViewData["Title"] = "setting_managedisk_cleanup";
    Layout = "~/Views/Shared/ownyit_main_page.cshtml";
}

<link href="~/css/bootstrap-datetimepicker.min.css" rel="stylesheet" />
<script src="~/js/moment.min.js"></script>
<script src="~/js/bootstrap-datetimepicker.min.js"></script>
<script src="~/js/main.js"></script>


<script>
    $(function () {
        $('input[name="cleanupdate"]').daterangepicker({
            singleDatePicker: true,
            autoUpdateInput: true,

            startDate: moment(),
            locale: {
                cancelLabel: 'Clear',
                format: 'DD.MM.YYYY'
            }
        })

        $('input[name="cleanupdate"]').on('apply.daterangepicker', function (ev, picker) {
            $(this).val(picker.startDate.format('DD.MM.YYYY'));
        });

        $('input[name="cleanupdate"]').on('cancel.daterangepicker', function (ev, picker) {
            $(this).val('');
        });

    });
</script>

<script type="text/javascript">
    $(document).ready(function () {
        $('#scheduletype').on('change', function () {

            if (this.value == '1') {
                $("#daily").show();
            }
            else {
                $("#daily").hide();
            }
            if (this.value == '2') {
                $("#weekly").show();
            }
            else {
                $("#weekly").hide();
            }

            if (this.value == '3') {
                $("#monthly").show();
            }
            else {
                $("#monthly").hide();
            }

        });
    });

</script>



<div class="row row_top_margin">
    <div class="col-sm-12 col-md-12 col-lg-12">
        <div class="ibox float-e-margins ">
            <div class="ibox-content" style="padding:4px;">
                <ul class="breadcrumb" style="margin-bottom:0px;">
                    <li>
                        @Html.ActionLink("Settings", "setting_scan_ip_range", "csat_settings_page")
                        <i class="icon-angle-right"></i>
                    </li>
                    <li> Manage Disk Cleanup Schedule </li>
                </ul>
            </div>
        </div>
    </div>
        <!--side menu-->
        <div class="col-sm-2 col-md-2 col-lg-2 no_padding">
            <div class="ibox float-e-margins ">
                <div class="ibox-content sidemenu">
                    @{
                        @Html.Partial("csat_settings_page_menu");
                    }
                </div>
            </div>
        </div>
        <!--side menu end-->

        <div class="col-sm-10 col-md-10 col-lg-10">
            <!--BackSide Generate white form color-->
            <div class="ibox float-e-margins" style="margin:0px;">
                <div class="ibox-content">
                    <!--BackSide Generate white form over-->
                    <div class="row">
                        <div class="col-sm-12 col-md-12 col-lg-12">
                            <button type="button" data-toggle="modal" class="btn btn-primary pull-right " style="margin-bottom: 5px;" onclick="AddSchedule()">Set Schedule <b style="font-weight:bolder;">+</b></button>
                            <div class="table-responsive" id="divbackupdisk">

                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="space_bottom">
            &nbsp;
        </div>
</div>

    <!--Set Schedule form content-->
    <div class="modal fade" id="set_schedule" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" data-backdrop="static" data-keyboard="false">
        <div class="modal-dialog modal-md">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true" onclick="cleardata()">&times;</button>
                    <h6 class="modal-title">Set Schedule </h6>
                </div>
                <div class="modal-body model_body_scroll">
                    <!--form  content-->
                    <div class="row">
                        <div class="col-sm-12 col-md-12 col-lg-12">
                            <div class="row">
                                <div class="col-xs-12">
                                    <form class="form-horizontal" method="post" name="add_user_form" onsubmit="return(validate());">
                                        <div class="form-group">
                                            <label for="nameField" class="col-xs-2">Schedule Type</label>
                                            <div class="col-xs-4">
                                                <select class="form-control col-sm-2 col-lg-2 col-md-2" name="scheduletype" id="scheduletype">
                                                    @*<option value="-1">Select Schedule Type</option>*@
                                                    <option value="1" selected>Daily</option>
                                                    <option value="2">weekly</option>
                                                    <option value="3">Monthly</option>
                                                </select>
                                            </div>
                                        </div>

                                        <div class="form-group">
                                            <label for="nameField" class="col-xs-2">Schedule Time </label>
                                            <div id="daily" class="daily">
                                                <div class="col-xs-4">
                                                    <input type="text" name="time" class="form-control" placeholder="hh:mm A - hh:mm A " id="date">
                                                </div>
                                            </div>
                                            <div id="weekly" style="display:none;">
                                                <div class="col-xs-4">
                                                    <select class="form-control col-sm-2 col-lg-2 col-md-2" name="weeklyday" id="weeklyday">
                                                        @*<option value="-1">Select Schedule Type</option>*@
                                                        <option value="-1">Select Day</option>
                                                        <option value="0">Sunday</option>
                                                        <option value="1">Monday</option>
                                                        <option value="2">Tuesday</option>
                                                        <option value="3">Wednesday</option>
                                                        <option value="4">Thursday</option>
                                                        <option value="5">Friday</option>
                                                        <option value="6">Saturday</option>
                                                    </select>
                                                </div>
                                                <div class="col-xs-3">
                                                    <input type="text" name="time" class="form-control" placeholder="hh:mm A - hh:mm A " id="date1">
                                                </div>

                                            </div>
                                            @*<div class="table-responsive">
                                                    <table class="table table-striped table-bordered disk_cleanup_table" style="width:100%">
                                                        <thead>
                                                            <tr>
                                                                <th class="col-sm-10" data-orderable="false"><input type="checkbox" class="parent" data-group=".group1" id="allday" />&nbsp;  Days</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody>
                                                            <tr>
                                                                <td class="col-sm-12">
                                                                    <div class='col-xs-4'><div class='radio'><input type='checkbox' class="group1" name="check[]" id='Sunday' value='Sunday' onchange='UncheckMain()' />&nbsp; Sunday    </div></div>
                                                                    <div class='col-xs-4'><div class='radio'><input type='checkbox' class="group1" name="check[]" id='Monday' value='Monday' onchange='UncheckMain()' />&nbsp; Monday    </div></div>
                                                                    <div class='col-xs-4'><div class='radio'><input type='checkbox' class="group1" name="check[]" id='Tuesday' value='Tuesday' onchange='UncheckMain()' />&nbsp; Tuesday   </div></div>
                                                                    <div class='col-xs-4'><div class='radio'><input type='checkbox' class="group1" name="check[]" id='Wednesday' value='Wednesday' onchange='UncheckMain()' />&nbsp; Wednesday </div></div>
                                                                    <div class='col-xs-4'><div class='radio'><input type='checkbox' class="group1" name="check[]" id='Thursday' value='Thursday' onchange='UncheckMain()' />&nbsp; Thursday  </div></div>
                                                                    <div class='col-xs-4'><div class='radio'><input type='checkbox' class="group1" name="check[]" id='Friday' value='Friday' onchange='UncheckMain()' />&nbsp; Friday    </div></div>
                                                                    <div class='col-xs-4'><div class='radio'><input type='checkbox' class="group1" name="check[]" id='Saturday' value='Saturday' onchange='UncheckMain()' />&nbsp; Saturday  </div></div>
                                                                </td>
                                                            </tr>
                                                        </tbody>
                                                       </table>
                                                </div>*@

                                            <div id="monthly" style="display:none;">
                                                <div class="col-xs-2">
                                                    <select class="form-control col-sm-2 col-lg-2 col-md-2" name="monthlydate" id="monthlydate">
                                                        <option value="-1">Select Date</option>
                                                        <option value="1">1</option>
                                                        <option value="2">2</option>
                                                        <option value="3">3</option>
                                                        <option value="4">4</option>
                                                        <option value="5">5</option>
                                                        <option value="6">6</option>
                                                        <option value="7">7</option>
                                                        <option value="8">8</option>
                                                        <option value="9">9</option>
                                                        <option value="10">10</option>
                                                        <option value="11">11</option>
                                                        <option value="12">12</option>
                                                        <option value="13">13</option>
                                                        <option value="14">14</option>
                                                        <option value="15">15</option>
                                                        <option value="16">16</option>
                                                        <option value="17">17</option>
                                                        <option value="18">18</option>
                                                        <option value="19">19</option>
                                                        <option value="20">20</option>
                                                        <option value="21">21</option>
                                                        <option value="22">22</option>
                                                        <option value="23">23</option>
                                                        <option value="24">24</option>
                                                        <option value="25">25</option>
                                                        <option value="26">26</option>
                                                        <option value="27">27</option>
                                                        <option value="28">28</option>
                                                        <option value="29">29</option>
                                                        <option value="30">30</option>
                                                        <option value="31">31</option>
                                                    </select>
                                                    @*<input type="text" name="cleanupdate" class="form-control " placeholder="DD/MM/YYYY " id="date2">*@
                                                </div>
                                                <div class="col-xs-2">
                                                    <input type="text" name="time" class="form-control " placeholder="hh:mm A " id="time">
                                                </div>
                                            </div>
                                        </div>


                                        <div class="form-group">
                                            <label for="nameField" class="col-xs-2 form_label">Branch/ Unit</label>
                                            <div class="col-xs-4">
                                                <select class="form-control col-sm-3 col-lg-3 col-md-3" name="Branch/Unit" id="drpou"></select>
                                            </div>
                                            <label for="nameField" class="col-xs-2 ">System Name</label>
                                            <div class="col-xs-4">
                                                <select class="form-control col-sm-3 col-lg-3 col-md-3" name="Device" id="drpdevice">
                                                    <option value="-1">Select System Name</option>
                                                </select>
                                            </div>
                                        </div>

                                        <div class="form-group">
                                            <label for="nameField" class="col-xs-2">IP Address</label>
                                            <div class="col-xs-4">
                                                <select class="form-control col-sm-3 col-lg-3 col-md-3" name="ip" id="drpip">
                                                    <option value="-1">Select IP Address</option>
                                                </select>
                                            </div>
                                            <div class="pull-left col-xs-1">
                                                <input type="button" class="btn btn-primary" value="Show" onclick="ShowData()">
                                            </div>
                                        </div>

                                    </form>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-sm-12 col-md-12 col-lg-12">
                                    <div class="table-responsive" id="divdiskdevice">

                                    </div>
                                    <div class="col-xs-12 pull-right ">
                                        <input type="button" class="btn btn-primary" value="Apply" name="Apply" onclick="return validate();" />
                                    </div>
                                    <div class="space_bottom">
                                        &nbsp;
                                    </div>
                                </div>

                            </div>
                        </div>
                    </div>  <!--form  content end-->
                </div>
            </div><!-- /.modal-content -->
        </div><!-- /.modal-dialog -->
    </div>
    <!--Set Schedule form content End-->

    <script>
        $(".parent").each(function (index) {
            var group = $(this).data("group");
            var parent = $(this);

            parent.change(function () {  //"select all" change
                $(group).prop('checked', parent.prop("checked"));
            });
            $(group).change(function () {
                parent.prop('checked', false);
                if ($(group + ':checked').length == $(group).length) {
                    parent.prop('checked', true);
                }
            });
        });
        $('.tree-toggle').click(function () {
            $(this).parent().children('ul.tree').toggle(200);
        });
        $(function () {
            $('.tree-toggle').parent().children('ul.tree').toggle(200);
        })
    </script>
    <script>
    var scandetails;
    // Get Disk schedule
    $.get(null, null, showdiskcleanup);
    function showdiskcleanup() {
        $.ajax({
            type: "POST",
            url: '@Url.Content("~/csat_settings_page/Showdiskcleanup")',
            success: function (data) {
            //    debugger;
                scandetails = "";
                var Setgriddata = $('#divbackupdisk');
                jQuery('#divbackupdisk').html('');
                var headdata = "<table class='table table-striped table-bordered disk_cleanup_table' id='disk_cleanup_table'  style='width:100%'><thead><tr> <th class='col-sm-2'>Branch/ Unit</th><th class='col-sm-2'>System Name</th>" +
                    "<th class='col-sm-1'>IP Address</th><th class='col-sm-1'>Type</th><th class='col-sm-6'>Details</th><th class='col-sm-1'>Time</th><th class='col-sm-2'>Last Cleanup</th><th class='col-sm-1'>Last Status</th></tr></thead><tbody>";
                var trdata = "";
                for (var i = 0; i < data.diskcleaup.length; i++) {
                    trdata += "<tr><td class='col-sm-2'>" + data.diskcleaup[i].ou_node_name + "</td>";
                    trdata += "<td class='col-sm-2'>" + data.diskcleaup[i].device_name + "</td>";
                    trdata += "<td class='col-sm-1'>" + data.diskcleaup[i].ip + "</td>";
                    trdata += "<td class='col-sm-1'>" + data.diskcleaup[i].type + "</td>";
                    //if (data.diskcleaup[i].type == "Weekly") {
                    //    if (data.diskcleaup[i].scandetails.substr(0, 1) == "1")
                    //        scandetails += ", Sunday";
                    //    if (data.diskcleaup[i].scandetails.substr(1, 1) == "1")
                    //        scandetails += ", Monday";
                    //    if (data.diskcleaup[i].scandetails.substr(2, 1) == "1")
                    //        scandetails += ", Tuesday";
                    //    if (data.diskcleaup[i].scandetails.substr(3, 1) == "1")
                    //        scandetails += ", Wednesday";
                    //    if (data.diskcleaup[i].scandetails.substr(4, 1) == "1")
                    //        scandetails += ", Thursday";
                    //    if (data.diskcleaup[i].scandetails.substr(5, 1) == "1")
                    //        scandetails += ", Friday";
                    //    if (data.diskcleaup[i].scandetails.substr(6, 1) == "1")
                    //        scandetails += ", Saturday";
                    //    if (scandetails.trim().length > 0)
                    //        scandetails = scandetails.substr(1);
                    //}
                    //else if (data.diskcleaup[i].type == "Daily")
                    //    scandetails = '';
                    //else
                    //    scandetails = data.diskcleaup[i].scandetails;
                    trdata += "<td class='col-sm-2'>" + data.diskcleaup[i].scandetails + "</td>";
                    trdata += "<td class='col-sm-1'>" + data.diskcleaup[i].scantime + "</td>";
                    trdata += "<td class='col-sm-2'></td>";
                    trdata += "<td class='col-sm-1'></td>";
                    trdata += "</tr>";
                    //scandetails = "";

             }
                 Setgriddata.append(headdata + trdata + "</tbody></table>");
                $(document).ready(function () {
                    $('#disk_cleanup_table').DataTable({
                        paging: true,
                        order: [],
                        columnDefs: [{ orderable: false, targets: [] }],
                        searching: false,
                        info: false,
                        responsive: false,

                    });
                    $(".table").css({ "width": "100%" });
                    $(".dataTables_scrollHeadInner ").css({ "width": "100%" });

                });
                }
        });
    }


    daysid = "";
    function UncheckMain() {
        //debugger;
        daysid = "";
        var checkboxes = document.querySelectorAll('input[class="group1"]');
        for (var i = 0; i < checkboxes.length; i++) {
            if (checkboxes[i].checked == true) {
                daysid += "," + checkboxes[i].value;
            }
            else {

            }

        }
    }

    function AddSchedule() {
     //   debugger;
        $('#set_schedule').modal('show');
    }
    $.get('@Url.Content("~/csat_report/GetOU/")', null, databind)
    function databind(data) {
        var url = '@Url.Content("~/csat_report/GetOU/")';
        $.ajax({
            type: "POST",
            url: url,
            success: function (data) {
                var SetOUDiv = $('#drpou');
                jQuery('#drpou').html('');
                var SetOUData = "<option value='-1'>Select Branch/ Unit</option>";
                for (var i = 0; i < data.ou.length; i++) {
                    SetOUData += "<option value='" + data.ou[i].ouid + "'>" + data.ou[i].ouname + "</option>";
                }
                SetOUDiv.append(SetOUData);
            }
        });
    }
      $("#drpou").change(function () {
        ouidvalue = this.value;
        var url = '@Url.Content("~/csat_report/Get_syatemname_ip?ouid=")' + this.value;
        $.ajax({
        type: "POST",
        url: url,
        success: function (data) {
            var SetDatadevice = $('#drpdevice');
            var SetDataip = $('#drpip');

            jQuery('#drpdevice').html('');
            jQuery('#drpip').html('');

            var devicedata = "<option value='-1'>Select System Name</option>";
            var ipdata = "<option value='-1'>Select IP Address</option>";

            for (var i = 0; i < data.systemip.length; i++) {
                devicedata+="<option value='"+ data.systemip[i].device_name +"'>"+ data.systemip[i].device_name +"</option>";
                ipdata+="<option value='"+ data.systemip[i].ip +"'>"+ data.systemip[i].ip +"</option>";
            }
            SetDatadevice.append(devicedata);
            SetDataip.append(ipdata);
            }
        });
    });

    function ShowData() {
      //  debugger;
        var ou_id = document.getElementById("drpou").value;
        var device_name = document.getElementById("drpdevice").value;
        var ip = document.getElementById("drpip").value;
        var url1 = '@Url.Content("~/csat_settings_page/GetDeviceData?ouid=")' + ou_id + '&device=' + device_name + '&ip=' + ip;
        $.ajax({
            type: "POST",
            url: url1,
            success: function (data) {
                //  debugger;
                var SetDeviceData = $('#divdiskdevice');
                jQuery('#divdiskdevice').html('');
                var DeviceData = "<table class='table table-striped table-bordered apply_disk_cleanup_table' id='apply_disk_cleanup_table1' style='width:100%'><thead><tr><th class='select noExport' data-orderable='false'><input type='checkbox' class='parent' onclick='checkallitemsbyname(this,this.name);' name='check1[]' data-group='.group12' /></th><th class='col-sm-8'>Branch/ Unit</th><th class='col-sm-2'>System Name</th><th class='col-sm-2'>IP Address</th></tr></thead><tbody>";
                for (var i = 0; i < data.getdevice.length; i++) {
                    DeviceData += "<tr>";
                    DeviceData += "<td class='select'><input type='checkbox' class='group12' name='check1[]' id='" + data.getdevice[i].ou_id + "' value='" + data.getdevice[i].device_id + "'  /></td>";
                    DeviceData += "<td class='col-sm-8'>" + data.getdevice[i].ou_node_name + "</td>";
                    DeviceData += "<td class='col-sm-3'>" + data.getdevice[i].device_name + "</td>";
                    DeviceData += "<td class='col-sm-4'>" + data.getdevice[i].ip + "</td>";
                    DeviceData += "</tr>";
                }
                DeviceData += "</tbody></table>";
                SetDeviceData.append(DeviceData);
                $(document).ready(function () {
                    $('#apply_disk_cleanup_table1').DataTable({
                        paging: true,
                        order: [],
                        columnDefs: [{ orderable: false, targets: [] }],
                        searching: false,
                        info: false,
                        responsive: false,

                    });
                    $(".table").css({ "width": "100%" });
                    $(".dataTables_scrollHeadInner ").css({ "width": "100%" });

                });
            }
        });

    }

    var singledeviceids = "";
    var singleouids = "";
    function getcheckeddevice() {
        //    debugger;
        singledeviceids = "";
        singleouids = "";
        var checkboxes = document.querySelectorAll('input[name="check1[]"]');
        for (var i = 1; i < checkboxes.length; i++) {
            if (checkboxes[i].checked == true) {
                singledeviceids += "," + checkboxes[i].value;
                singleouids += "," + checkboxes[i].id;
            }
            else {
            }
        }
    }
    function validate() {
        getcheckeddevice();
        if (singledeviceids == "") {
            alert("Please select device !!!");
            return false;
        }
        else
            Adddiskschedule();
    }


    function Adddiskschedule() {
       // debugger;
        var backuptype1 = document.getElementById("scheduletype").value;
        var backuptime = '';
        var bacupdetails = '';
        if (backuptype1 == '1') {
            backuptime = document.getElementById("date").value;
            bacupdetails = null;
        }
        if (backuptype1 == '2') {
            backuptime = document.getElementById("date1").value;
            bacupdetails = document.getElementById("weeklyday").value;

            //if (document.getElementById("Sunday").checked == true)
            //    bacupdetails = bacupdetails + "1";
            //else
            //    bacupdetails = bacupdetails + "0";
            //if (document.getElementById("Monday").checked == true)
            //    bacupdetails = bacupdetails + "1";
            //else
            //    bacupdetails = bacupdetails + "0";
            //if (document.getElementById("Tuesday").checked == true)
            //    bacupdetails = bacupdetails + "1";
            //else
            //    bacupdetails = bacupdetails + "0";
            //if (document.getElementById("Wednesday").checked == true)
            //    bacupdetails = bacupdetails + "1";
            //else
            //    bacupdetails = bacupdetails + "0";
            //if (document.getElementById("Thursday").checked == true)
            //    bacupdetails = bacupdetails + "1";
            //else
            //    bacupdetails = bacupdetails + "0";
            //if (document.getElementById("Friday").checked == true)
            //    bacupdetails = bacupdetails + "1";
            //else
            //    bacupdetails = bacupdetails + "0";
            //if (document.getElementById("Saturday").checked == true)
            //    bacupdetails = bacupdetails + "1";
            //else
            //    bacupdetails = bacupdetails + "0";

        }
        if (backuptype1 == '3') {
            backuptime = document.getElementById("time").value;
            bacupdetails = document.getElementById("monthlydate").value;
        }
        $.ajax({
            type: "POST",
            url: '@Url.Content("~/csat_settings_page/Adddiskcleanupschedule?backuptype=")' + backuptype1 + '&backupdetails=' + bacupdetails + '&backuptime=' + backuptime + '&deviceid=' + singledeviceids,
            success: function (result) {
                alert(result);
                showdiskcleanup();
            }
        });

    }
    function cleardata() {
        $('input[type="checkbox"]:checked').prop('checked', false);
        jQuery('#divdiskdevice').html('');
        document.getElementById('scheduletype').value = "1";
        $("#daily").show();
        document.getElementById("drpou").value = "-1";
        document.getElementById("drpdevice").value = "-1";
        document.getElementById("drpip").value = "-1";
        $("#weekly").hide();
        $("#monthly").hide();

    }

    </script>
    <script>
        $(function () {
            $('input[name="time"]').daterangepicker({

                //autoUpdateInput: true,
                singleDatePicker: true,
                timePicker: true,
                timePickerSeconds: false,
                timePicker24Hour: true,
                startDate: moment(),
                locale: {
                    cancelLabel: 'Clear',
                    format: 'HH:mm ',
                }
            });
            $('.calendar-table').css('display', 'none');

            $('input[name="time"]').on('apply.daterangepicker', function (ev, picker) {

                $(this).val(picker.startDate.format(' HH:mm '));
            });

            $('input[name="time"]').on('cancel.daterangepicker', function (ev, picker) {
                $(this).val('');
            });
        });

    </script>
