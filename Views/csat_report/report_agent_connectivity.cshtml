
@{
    ViewData["Title"] = "report_agent_connectivity";
    Layout = "~/Views/Shared/ownyit_main_page.cshtml";
}


@*<div class="row">
        <div class="headerbar">
            <a href="#" style="padding-left:10px;">Report</a>
        </div>
    </div>*@
<div class="row">

    <div class="ibox float-e-margins ">
        <div class="ibox-content" style="padding:4px;">
            <ul class="breadcrumb" style="margin-bottom:0px;">
                <li>
                    @Html.ActionLink("Reports", "report_agent_information", "csat_report")
                    <i class="icon-angle-right"></i>
                </li>
                <li> Agent Connectivity </li>
            </ul>
        </div>
    </div>


    <!--side menu-->
    <div class="col-sm-2 col-md-2 col-lg-2 no_padding">
        <div class="ibox float-e-margins ">
            <div class="ibox-content sidemenu">
                @{
                    @Html.Partial("csat_report_menu");
                }
            </div>
        </div>
    </div>
    <!--side menu end-->

    <div class="col-sm-10 col-md-10 col-lg-10">
        <div class="ibox float-e-margins" style="margin-bottom: 10px;">
            <div class="ibox-content">
                <div class="row">
                    <div class="col-sm-12 col-md-12 col-lg-12">

                        <div class="row">
                            <div class="col-xs-12">
                                <form class="form-horizontal" method="post">
                                    <div class="form-group">
                                        <label for="nameField" style="margin-top: -5px;background-color: #fff;text-align: center;color: #3D93C8;width: 120px;" class="col-xs-2 form_label">&nbsp;&nbsp;Advance Search&nbsp;&nbsp;</label>
                                        <div class="col-xs-10">
                                        </div>
                                    </div>

                                </form>
                            </div>
                        </div>
                    </div>

                </div>

                <div class="row">

                    <div class="col-sm-12 col-md-12 col-lg-12">
                        <div class="row">
                            <div class="col-xs-12">
                                <form class="form-horizontal" method="post" name="frm_agentconnect_report" id="frm_agentconnect_report">
                                    <div class="form-group">
                                        <label for="nameField" class="col-sm-1 form_label">Branch/ Unit</label>
                                        <div class="col-xs-4">
                                            <select class="form-control col-sm-3 col-lg-3 col-md-3" name="Branch/Unit" id="drpou">
                                                <option value='-1'>Select Branch/ Unit</option>
                                            </select>
                                        </div>
                                        <label for="nameField" class="col-xs-1 form_label">System Name</label>
                                        <div class="col-xs-2" id="selectsys">
                                            <select class="form-control col-sm-3 col-lg-3 col-md-3" name="Device" id="drpdevice">
                                                <option value="-1">Select System Name</option>
                                            </select>
                                        </div>
                                        <div class="col-xs-2" id="inputsystemname">
                                            <input type="text" class="form-control col-sm-3 col-lg-3 col-md-3" name="add_systemname" id="add_systemname">
                                        </div>
                                        <div class="col-xs-1">
                                            <input type="checkbox" class="form-check-input" id="add_system_chk" name="add_system_chk" style="width:20px;height:25px;">
                                        </div>
                                        <label for="nameField" class="col-xs-1 form_label" style="margin-left:-48px;">IP Address</label>
                                        <div class="col-xs-2">
                                            <input type="text" class="form-control col-sm-3 col-lg-3 col-md-3" placeholder="" name="drpip" id="drpip">
                                            @*<select class="form-control col-sm-3 col-lg-3 col-md-3" name="ip" id="drpip">
                                                    <option value="-1">Select IP Address</option>
                                                </select>*@
                                        </div>
                                    </div>

                                    <div class="form-group">
                                        <label for="nameField" class="col-sm-1 form_label">Date Range</label>
                                        <div class="col-xs-4">
                                            <input type="text" name="datetime1" class="form-control" placeholder="DD/MM/YYYY -  DD/MM/YYYY " id="dateAutopower">
                                        </div>
                                        <label for="nameField" class="col-xs-1 form_label">Category Wise</label>
                                        <div class="col-xs-3">
                                            <select class="form-control col-sm-3 col-lg-3 col-md-3" id="drpcat">
                                                <option value="-1">Select Category</option>
                                                <option value='al.hardware_info'>Hardware</option>
                                                <option value='al.software_info'>Software</option>
                                                <option value='al.share_info'>Share</option>
                                                <option value='al.user_category_info'>User</option>
                                                <option value='al.service_info'>Service</option>
                                                <option value='al.process_info'>Process</option>
                                                <option value='al.drive_info'>Drive</option>
                                                <option value='al.system_info'>System</option>
                                                <option value='al.network_info'>Network</option>
                                            </select>
                                        </div>
                                        <div class="pull-left col-xs-1">
                                            <input type="button" class="btn btn-primary" value="Show" onclick="GetAgentConnData()">
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="row ibox2">
            <div class="col-sm-12 col-md-12 col-lg-12 ibox2-content" id="divagentconn_div">
                <table id="divagentconn" class="table table-striped table-bordered display nowrap" width="100%"></table>
            </div>
        </div>
        <div class="row ibox2">
            <div class="col-sm-12 col-md-12 col-lg-12 ibox2-content">
                <div class="table-responsive" id="divagentconn1" style="display:none;">
                </div>
            </div>
        </div>

    </div>

    <div class="space_bottom">&nbsp;</div>
</div>
<script>
    $(document).ready(function () {
        validateSingleForm("#frm_agentconnect_report");
    });
</script>
<script>
 $.get('@Url.Content("~/csat_report/GetOU/")', null, DataBind)
    function DataBind(data) {
        $("#overlay").show();
        $("#overlay").fadeIn(300);
       // debugger;
        var url = '@Url.Content("~/csat_report/GetOU/")';
        $.ajax({
            type: "POST",
            url: url,
            success: function (data) {
            var SetData = $('#drpou');
            jQuery('#drpou').html('');
            var oudata = "<option value='-1'>Select Branch/ Unit</option>";
            for (var i = 0; i < data.ou.length; i++) {
                oudata += "<option value='" + data.ou[i].ouid + "'>" + data.ou[i].ouname + "</option>";
            }
            SetData.append(oudata);
            }
        }).done(function () {
            setTimeout(function () {
                $("#overlay").fadeOut(300);
            }, 500);
        });
    }
    var ouidvalue = '';
$("#drpou").change(function () {
        ouidvalue = this.value;
        var url = '@Url.Content("~/csat_report/Get_syatemname_ip?ouid=")' + this.value;
        $.ajax({
        type: "POST",
        url: url,
        success: function (data) {
        // debugger;
        var SetDatadevice = $('#drpdevice');
        //var SetDataip = $('#drpip');
        jQuery('#drpdevice').html('');
        //jQuery('#drpip').html('');

        var devicedata = "<option value='-1'>Select System Name</option>";
        //var ipdata = "<option value='-1'>Select IP Address</option>";

        for (var i = 0; i < data.systemip.length; i++) {
           devicedata+="<option value='"+ data.systemip[i].device_name +"'>"+ data.systemip[i].device_name +"</option>";
           //ipdata+="<option value='"+ data.systemip[i].ip +"'>"+ data.systemip[i].ip +"</option>";
            }
            SetDatadevice.append(devicedata);
            //SetDataip.append(ipdata);
        }
        });

    if (ouidvalue != "-1") {
        $("#divagentconn1").show();
        $("#divagentconn").hide();
        document.getElementById('drpcat').disabled = true;
        document.getElementById('dateAutopower').disabled = true;
        document.getElementById('drpip').disabled = true;
        document.getElementById('drpcat').value = "-1";

    }
    else {
        document.getElementById('drpcat').disabled = false;
        document.getElementById('dateAutopower').disabled = false;
        document.getElementById('drpip').disabled = false;
        $("#divagentconn").show();
        $("#divagentconn1").hide();
    }
    });


    $("#drpdevice").change(function () {
        var device = document.getElementById('drpdevice').value;
        if (device != "-1") {
            $("#divagentconn1").show();
            $("#divagentconn").hide();
            document.getElementById('drpcat').disabled = true;
            document.getElementById('dateAutopower').disabled = true;
            document.getElementById('drpip').disabled = true;
            document.getElementById('drpcat').value = "-1";

        }
        else {
            document.getElementById('drpcat').disabled = false;
            document.getElementById('dateAutopower').disabled = false;
            document.getElementById('drpip').disabled = false;
            $("#divagentconn").show();
            $("#divagentconn1").hide();
        }
        });


    function GetAgentConnData() {
        var $valid = $('#frm_agentconnect_report').valid();
        if (!$valid) {
            $validatorform.focusInvalid();
            return false;
        } else{
        $("#overlay").show();
        $("#overlay").fadeIn(300);
        startdate = $('#dateAutopower').data('daterangepicker').startDate.format('DD/MM/YYYY');
        enddate = $('#dateAutopower').data('daterangepicker').endDate.format('DD/MM/YYYY');
        var ip = document.getElementById('drpip').value;
            //var device = document.getElementById('drpdevice').value;
            var device = document.getElementById('add_systemname').value;
            if (device== "") {
                device = document.getElementById("drpdevice").value;
            }
        var category = document.getElementById('drpcat').value;
        var categorytext = $('#drpcat option:selected').text();
        var divheader = '';
            if (device == "-1") {
                if (category == "-1") {
                    alert("Please select any category!")
                    setTimeout(function () {
                        $("#overlay").fadeOut(300);
                    }, 500);
                }
                else {
                    var url = '@Url.Content("~/csat_report/GetAgentConnData?ouid=")' + ouidvalue + '&ip=' + ip + '&startdate=' + startdate + '&enddate=' + enddate + '&category=' + category;
                    $.ajax({
                        type: "POST",
                        url: url,
                        success: function (data) {
                            var dataclear = document.getElementById('divagentconn_div');
                            dataclear.innerHTML = '&nbsp;';
                            $('#divagentconn_div').append("<table id='divagentconn' class='table table-striped table-bordered' width='100%'></table>");
                            otable = document.getElementById('divagentconn');
                            var data1 = [];
                            for (var i = 0; i < data.getsysinfo.length; i++) {
                                data1.push([data.getsysinfo[i].ou_longname, data.getsysinfo[i].device_name, data.getsysinfo[i].ip, data.getsysinfo[i].hardware]);
                            }
                            var otable = $("#divagentconn").DataTable({
                                data: data1, scrollX: !0, searching: !1, dom: "<'top'lB>rt<'bottom'ip><'clear'>", buttons: ["colvis", { text: "PDF", extend: "pdfHtml5", download: "open", filename: "Manage Agent-Registry_" + today, orientation: "portrait", pageSize: "A4", exportOptions: { columns: ":visible", search: "applied", order: "applied" }, customize: function (t) { t.content.splice(0, 1); var e = new Date, n = e.getDate() + "-" + (e.getMonth() + 1) + "-" + e.getFullYear(); t.pageMargins = [20, 60, 20, 30], t.defaultStyle.fontSize = 7, t.styles.tableHeader.fontSize = 7, t.header = function () { return { columns: [{ margin: [0, -5, 30, 15], alignment: "left", width: 100, image: "data:image/png;base64," + pdflogo }, { margin: [-10, 10, 10, 0], alignment: "center", width: 410, text: "Manage Agent-Registry Report", fontSize: 12 }, { alignment: "right", fontSize: 14, text: "" }], margin: 20 } }, t.footer = function (t, e) { return { columns: [{ alignment: "left", text: ["Created on: ", { text: n.toString() }] }, { alignment: "right", text: ["page ", { text: t.toString() }, " of ", { text: e.toString() }] }], margin: 20 } }; var a = { hLineWidth: function (t) { return .5 }, vLineWidth: function (t) { return .5 }, hLineColor: function (t) { return "#aaa" }, vLineColor: function (t) { return "#aaa" }, paddingLeft: function (t) { return 4 }, paddingRight: function (t) { return 4 } }; t.content[0].layout = a } }, 'excel'],
                                columns: [{ title: "Branch/ Unit" }, { title: "System Name" }, { title: "IP Address" }, { title: "" + categorytext + "" }]
                            });
                            $(".table").css({ "width": "100%" });
                            $(".dataTables_scrollHeadInner ").css({ "width": "100%" });
                        }
                    }).done(function () {
                        setTimeout(function () {
                            $("#overlay").fadeOut(300);
                        }, 500);
                    });
                }

            }
            else {
                var url1 = '@Url.Content("~/csat_report/GetAgentConnsyswiseData?ouid=")' + ouidvalue + '&ip=' + ip + '&system=' + device;
                $.ajax({
                    type: "POST",
                    url: url1,
                    success: function (data) {
                        //  debugger;
                        var SetData = $('#divagentconn1');
                        $('#divagentconn1').html('');
                        divheader = "<div id='system_info'><table class='table table-striped table-bordered tbl_pdfexport_count'  style='width:100%'><thead><tr>" +
                            "<th class='col-sm-6'>Category Wise</th><th class='col-sm-6'>Time Stamp</th></tr></thead><tbody>";
                        if (data.getsyscatinfo.length != "0") {
                            divheader += "<tr><td class='col-sm-6'>Hardware</td><td class='col-sm-6'>" + data.getsyscatinfo[0].hardware + "</td>" +
                                " </tr><tr><td class='col-sm-6'>Software</td><td class='col-sm-6'>" + data.getsyscatinfo[0].software + "</td>" +
                                " </tr><tr><td class='col-sm-6'>Share</td><td class='col-sm-6'>" + data.getsyscatinfo[0].share + "</td>" +
                                " </tr><tr><td class='col-sm-6'>User</td><td class='col-sm-6'>" + data.getsyscatinfo[0].user1 + "</td>" +
                                " </tr><tr><td class='col-sm-6'>Service</td><td class='col-sm-6'>" + data.getsyscatinfo[0].service + "</td>" +
                                " </tr><tr><td class='col-sm-6'>Process</td><td class='col-sm-6'>" + data.getsyscatinfo[0].process + "</td>" +
                                " </tr><tr><td class='col-sm-6'>Drive</td><td class='col-sm-6'>" + data.getsyscatinfo[0].drive + "</td>" +
                                " </tr><tr><td class='col-sm-6'>System</td><td class='col-sm-6'>" + data.getsyscatinfo[0].system + "</td>" +
                                " </tr><tr><td class='col-sm-6'>Network</td><td class='col-sm-6'>" + data.getsyscatinfo[0].network + "</td>" +
                                "</tr>";
                        }
                        SetData.append(divheader + "</tbody></table></div>");
                        reportname = "Agent Connectivity Report";
                        datatable_pdfexport_counting(reportname);
                    }
                }).done(function () {
                    setTimeout(function () {
                        $("#overlay").fadeOut(300);
                    }, 500);
                });
            }
        }
    }
</script>
<script type="text/javascript">
    var startdate = '';
    var enddate = '';
    $(function () {
        $('input[name="datetime1"]').daterangepicker({
            autoUpdateInput: true,
            timePicker: true,
            timePickerSeconds: true,
            timePicker24Hour: true,
            startDate: moment().add(-24, 'hour'),
            endDate: moment(),
            locale: {
                cancelLabel: 'Clear',
                format: 'DD/MM/YYYY hh:mm:ss '
            }
        });

        $('input[name="datetime1"]').on('apply.daterangepicker', function (ev, picker) {
            $(this).val(picker.startDate.format('DD/MM/YYYY hh:mm:ss') + ' - ' + picker.endDate.format('DD/MM/YYYY hh:mm:ss'));
            startdate = picker.startDate.format('DD/MM/YYYY');
            enddate = picker.endDate.format('DD/MM/YYYY');
        });

        $('input[name="datetime"]').on('cancel.daterangepicker', function (ev, picker) {
            $(this).val('');
        });

    });
</script>
<script>
    //checkbox input hide & show
    $('#inputsystemname').hide();
    $('#add_system_chk').on('click', function () {
        if ($(this).is(':checked')) {
            $('#selectsys').hide();
            $('#inputsystemname').show();
        }
        else {
            $('#selectsys').show();
            $('#inputsystemname').hide();
            document.getElementById('add_systemname').value = "";
        }
    });
</script>