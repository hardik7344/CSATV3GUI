@{
    ViewData["Title"] = "report_event_monitoring";
    Layout = "~/Views/Shared/ownyit_main_page.cshtml";
}
<script>

    $('input[name="datefilter"]').val('');
    $(function () {

        $('input[name="datefilter"]').daterangepicker({
            autoUpdateInput: true,
            startDate: moment().startOf('hour').add(-24, 'hour'),
            endDate: moment().startOf('hour'),
            locale: {
                format: 'DD/MM/YYYY',
                cancelLabel: 'Clear'
            }
        });

        $('input[name="datefilter"]').on('apply.daterangepicker', function (ev, picker) {
            //  debugger;
            $(this).val(picker.startDate.format('DD/MM/YYYY') + ' - ' + picker.endDate.format('DD/MM/YYYY'));
            startdate = picker.startDate.format('DD/MM/YYYY');
            enddate = picker.endDate.format('DD/MM/YYYY');

        });

        $('input[name="datefilter"]').on('cancel.daterangepicker', function (ev, picker) {
            $(this).val('');
        });

        $(window).bind('scroll', function () {
            $(".daterangepicker").hide();
        });

    });
    var now = new Date();
    var day = ("0" + now.getDate()).slice(-2);
    var month = ("0" + (now.getMonth() + 1)).slice(-2);
    var today = now.getFullYear() + "-" + (month) + "-" + (day);


</script>


<div class="row">

    <div class="ibox float-e-margins ">
        <div class="ibox-content" style="padding:4px;">
            <ul class="breadcrumb" style="margin-bottom:0px;">
                <li>
                    @Html.ActionLink("Reports", "report_agent_information", "csat_report")
                    <i class="icon-angle-right"></i>
                </li>
                <li> Event Monitoring  </li>
            </ul>
        </div>
    </div>


    <!--side menu-->
    <div class="col-sm-2 col-md-2 col-lg-2 no_padding">
        <div class="ibox float-e-margins ">
            <div class="ibox-content sidemenu">
                @{
                    @Html.Partial("csat_report_menu");
                }
            </div>
        </div>
    </div>
    <!--side menu end-->
    <div class="col-sm-10 col-md-10 col-lg-10">
        <div class="ibox float-e-margins" style="margin-bottom: 10px;">
            <div class="ibox-content">
                <div class="row">
                    <div class="col-sm-12 col-md-12 col-lg-12">

                        <div class="row">
                            <div class="col-xs-12">
                                <form class="form-horizontal" method="post">
                                    <div class="form-group">
                                        <label for="nameField" style="margin-top: -5px;background-color: #fff;text-align: center;color: #3D93C8;width: 120px;" class="col-xs-2 form_label">&nbsp;&nbsp;Advance Search&nbsp;&nbsp;</label>
                                        <div class="col-xs-10">
                                        </div>
                                    </div>

                                </form>
                            </div>
                        </div>
                    </div>

                </div>
                <div class="row">
                    <div class="col-sm-12 col-md-12 col-lg-12">
                        <div class="row">
                            <div class="col-xs-12">
                                <form class="form-horizontal" method="post" name="frm_eventmoniter" id="frm_eventmoniter">
                                    <div class="form-group">
                                        <label for="nameField" class="col-xs-1 form_label">Branch/ Unit</label>
                                        <div class="col-xs-4">
                                            <select class="form-control col-sm-3 col-lg-3 col-md-3" name="Branch/Unit" id="drpou">
                                                <option value='-1'>Select Branch/ Unit</option>
                                            </select>
                                        </div>
                                        <label for="nameField" class="col-xs-1 form_label">System Name</label>
                                        <div class="col-xs-2">
                                            <input type="text" class="form-control col-sm-3 col-lg-3 col-md-3" name="add_systemname" id="add_systemname">
                                        </div>
                                        <label for="nameField" class="col-xs-1 form_label">IP Address</label>
                                        <div class="col-xs-2">
                                            <input type="text" class="form-control" id="add_evemon_apadd" name="add_evemon_apadd" placeholder="Enter IP Address" />
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label for="nameField" class="col-xs-1 form_label">Search</label>
                                        <div class="col-xs-2">
                                            <select class="form-control col-sm-2 col-lg-2 col-md-2" name="eventtype" id="eventtype">
                                                <option value="-1">Select Event Type</option>
                                                <option value="Security">Security</option>
                                                <option value="Service">Service</option>
                                                <option value="Application">Application</option>
                                                <option value="Setup">Setup</option>
                                            </select>
                                        </div>
                                        <div class="col-xs-3">
                                            <div class="input-group">
                                                <input type="search" class="form-control" placeholder="Event ID" id="txtsearcheventid" name="txtsearcheventid" autocomplete="off">
                                                <div class="input-group-btn">
                                                    <button class="btn btn-default" type="button" onclick="EventData()">
                                                        <i class="glyphicon glyphicon-search"></i>
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                        <label for="nameField" class="col-xs-1 form_label">Date-Range</label>
                                        <div class="col-xs-3">
                                            <input type="text" name="datefilter" class="form-control" placeholder="DD-MM-YYYY - DD-MM-YYYY " id="eventdate">
                                        </div>
                                        <div class="pull-left col-xs-1">
                                            <input type="button" class="btn btn-primary" value="Show" onclick="EventData()">
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="row ibox2">
            <div class="col-sm-12 col-md-12 col-lg-12 ibox2-content">
                <div class="table-responsive" id="tblevent">

                </div>
            </div>
        </div>

        <div class="space_bottom">&nbsp;</div>
    </div>
</div>

<!--Apply Event Start-->
<div class="modal fade" id="event_count" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" data-backdrop="static" data-keyboard="false">
    <div class="modal-dialog  modal-lg" style="margin-top: 82px;">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true" onclick="cleardata()">&times;</button>
                <h6 class=" modal-title">
                    Apply Event
                </h6>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-sm-12 col-md-12 col-lg-12 " id="tblapplyevent_div">
                        <table id="tblapplyevent" class="table table-striped table-bordered display nowrap" width="100%"></table>
                    </div>
                </div>

                &nbsp;  &nbsp;
                <div class="row">
                    <div class="col-xs-12">
                        <form class="form-horizontal" method="post" name="frm_eventcount" id="frm_eventcount">
                            <div class="form-group">
                                <label for="nameField" class="col-xs-1  form_label">Branch/ Unit</label>
                                <div class="col-xs-3">
                                    <select class="form-control col-sm-3 col-lg-3 col-md-3" name="Branch/Unit" id="drpou1">
                                        <option value='-1'>Select Branch/ Unit</option>
                                    </select>
                                </div>
                                <label for="nameField" class="col-xs-1 form_label">System Name</label>
                                <div class="col-xs-2" id="selectsys">
                                    div class="col-xs-2">
                                    <select class="form-control col-sm-3 col-lg-3 col-md-3" name="System" id="system">
                                        <option value="-1">Select System Name</option>
                                    </select>
                                </div>
                                <div class="col-xs-2" id="inputsystemname">
                                    <input type="text" class="form-control col-sm-3 col-lg-3 col-md-3" name="add_systemname" id="add_systemname">
                                </div>
                                <div class="col-xs-1">
                                    <input type="checkbox" class="form-check-input" id="add_system_chk" name="add_system_chk" style="width:20px;height:25px;">
                                </div>
                                <label for="nameField" class="col-xs-1 form_label">IP Address</label>
                                <div class="col-xs-2">
                                    <input type="text" class="form-control col-sm-3 col-lg-3 col-md-3" placeholder="" name="ip" id="ip">
                                </div>
                                <div class="pull-left col-xs-1">
                                    <input type="button" class="btn btn-primary" value="Show" onclick="applyeventshow()">
                                </div>
                            </div>

                        </form>
                    </div>
                </div>
                <div class="row">
                    <div class="col-sm-12 col-md-12 col-lg-12 " id="tblapplyshow_div">
                        <table id="tblapplyshow" class="table table-striped table-bordered display nowrap" width="100%"></table>
                    </div>
                </div>

            </div>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-primary" data-dismiss="modal" onclick="cleardata()">Close</button>
        </div>
    </div><!-- /.modal-content -->
</div><!-- /.modal-dialog -->
<!--Apply Event  End-->
<script>
    $(document).ready(function () {
        validateSingleForm("#frm_eventmoniter");
        validateSingleForm("#frm_eventcount");

    });
</script>
<script>
    $.get('@Url.Content("~/csat_report/GetOU/")', null, DataBind)
        function DataBind(data) {
            $("#overlay").show();
            $("#overlay").fadeIn(300);
       // debugger;
        var url = '@Url.Content("~/csat_report/GetOU/")';
        $.ajax({
            type: "POST",
            url: url,
            success: function (data) {
                var SetData = $('#drpou');
                jQuery('#drpou').html('');
                var SetData1 = $('#drpou1');
                jQuery('#drpou1').html('');
                var oudata = "<option value='-1'>Select Branch/ Unit</option>";
                for (var i = 0; i < data.ou.length; i++) {
                    oudata += "<option value='" + data.ou[i].ouid + "'>" + data.ou[i].ouname + "</option>";
                }
                SetData.append(oudata);
                SetData1.append(oudata);
            }
        }).done(function () {
            setTimeout(function () {
                $("#overlay").fadeOut(300);
            }, 500);
        });
    }

    $("#drpou1").change(function () {
        var url = '@Url.Content("~/csat_report/Get_syatemname_ip?ouid=")' + this.value;
        $.ajax({
            type: "POST",
            url: url,
            success: function (data) {
				var SetDatadevice = $('#system');
				//var SetDataip = $('#ip');
			    jQuery('#system').html('');
			    //jQuery('#ip').html('');
		        var devicedata = "<option value='-1'>Select System Name</option>";
		        //var ipdata = "<option value='-1'>Select IP Address</option>";
      	        for (var i = 0; i < data.systemip.length; i++) {
			        devicedata+="<option value='"+ data.systemip[i].device_name +"'>"+ data.systemip[i].device_name +"</option>";
				    //ipdata+="<option value='"+ data.systemip[i].ip +"'>"+ data.systemip[i].ip +"</option>";
				}
                SetDatadevice.append(devicedata);
				//SetDataip.append(ipdata);
            }
        });
    });

    var ouidvalue1 = "";
    $("#drpou1").change(function () {
        ouidvalue1 = this.value;
    });

    var systemvalue = "";
    $("#system").change(function () {
        systemvalue = this.value;
    });

    //var ipvalue = "";
    //$("#ip").change(function () {
    //    ipvalue = this.value;
    //});
</script>

<script>
        function EventData() {
            var $valid = $('#frm_eventmoniter').valid();
            if (!$valid) {
                $validatorform.focusInvalid();
                return false;
            } else {
                $("#overlay").show();
                $("#overlay").fadeIn(300);
                //debugger;
                var ouidvalue = document.getElementById('drpou').value;
                startdate = $('#eventdate').data('daterangepicker').startDate.format('DD/MM/YYYY');
                enddate = $('#eventdate').data('daterangepicker').endDate.format('DD/MM/YYYY');
                var sysname = document.getElementById('add_systemname').value;
                var ipadd = document.getElementById('add_evemon_apadd').value;
                var fieldsearch = document.getElementById('eventtype').value;
                var fieldsearchval = document.getElementById('txtsearcheventid').value;
                var url = '@Url.Content("~/csat_report/report_event_monitoring_data?ouid=")' + ouidvalue + '&startdate=' + startdate + '&enddate=' + enddate + '&fieldserach=' + fieldsearch + '&valuesearch=' + fieldsearchval + '&devicename=' + sysname + '&ipaddress=' + ipadd;
                $.ajax({
                    type: "POST",
                    url: url,
                    success: function (data) {
                        var SetEventDataDiv = $('#tblevent');
                        jQuery('#tblevent').html('');
                        var SetEventData = "<table class='table table-striped table-bordered tblpaging' style='width:100%'><thead><tr><th class='col-sm-3'>Event Type</th><th class='col-sm-2'>Event ID</th><th class='col-sm-6'>Event Description</th><th class='col-sm-1'>Count</th></tr></thead><tbody>";
                        for (var i = 0; i < data.event_data.length; i++) {
                            SetEventData += "<tr>";
                            SetEventData += "<td class='col-sm-3'>" + data.event_data[i].event_type + "</td>";
                            SetEventData += "<td class='col-sm-2'>" + data.event_data[i].event_id + "</td>";
                            SetEventData += "<td class='col-sm-6'>" + data.event_data[i].username + "</td>";
                            SetEventData += "<td class='col-sm-1 noExport'><a href='' data-toggle='modal' data-target='#event_count' onclick=eventcountdata('" + data.event_data[i].event_type + "'," + data.event_data[i].event_id + ",'" + encodeURIComponent(data.event_data[i].username) + "')>" + data.event_data[i].counts + "</a></td>";
                            SetEventData += "</tr >";
                        }
                        SetEventData += "</tbody></table>";

                        SetEventDataDiv.append(SetEventData);
                        datatable_paging();
                    }
                }).done(function () {
                    setTimeout(function () {
                        $("#overlay").fadeOut(300);
                    }, 500);
                });
            }
    }

    function eventcountdata(eventtype, eventid, username) {
        var url = '@Url.Content("~/csat_report/apply_event_count_data?etype=")' + eventtype + '&eid=' + eventid + '&edescription=' + username;
        $.ajax({
            type: "POST",
            url: url,
            success: function (data) {
                var dataclear = document.getElementById('tblapplyevent_div');
                dataclear.innerHTML = '&nbsp;';
                $('#tblapplyevent_div').append("<table id='tblapplyevent' class='table table-striped table-bordered' width='100%'></table>");
                otable = document.getElementById('tblapplyevent');
                var data1 = [];
                for (var i = 0; i < data.apply_event_data.length; i++) {
                    data1.push([data.apply_event_data[i].event_type, data.apply_event_data[i].event_id, data.apply_event_data[i].username]);
                }
                var otable = $("#tblapplyevent").DataTable({
                    data: data1, scrollX: !0, searching: !1, dom: "<'top'lB>rt<'bottom'ip><'clear'>", buttons: ["colvis", { text: "PDF", extend: "pdfHtml5", download: "open", filename: "Event Monitoring_" + today, orientation: "portrait", pageSize: "A4", exportOptions: { columns: ":visible", search: "applied", order: "applied" }, customize: function (t) { t.content.splice(0, 1); var e = new Date, n = e.getDate() + "-" + (e.getMonth() + 1) + "-" + e.getFullYear(); t.pageMargins = [20, 60, 20, 30], t.defaultStyle.fontSize = 7, t.styles.tableHeader.fontSize = 7, t.header = function () { return { columns: [{ margin: [0, -5, 30, 15], alignment: "left", width: 100, image: "data:image/png;base64," + pdflogo }, { margin: [-10, 10, 10, 0], alignment: "center", width: 410, text: "Event Monitoring Report", fontSize: 12 }, { alignment: "right", fontSize: 14, text: "" }], margin: 20 } }, t.footer = function (t, e) { return { columns: [{ alignment: "left", text: ["Created on: ", { text: n.toString() }] }, { alignment: "right", text: ["page ", { text: t.toString() }, " of ", { text: e.toString() }] }], margin: 20 } }; var a = { hLineWidth: function (t) { return .5 }, vLineWidth: function (t) { return .5 }, hLineColor: function (t) { return "#aaa" }, vLineColor: function (t) { return "#aaa" }, paddingLeft: function (t) { return 4 }, paddingRight: function (t) { return 4 } }; t.content[0].layout = a } }, 'excel'],
                    columns: [{ title: "Event Type" }, { title: "Event ID" }, { title: "Event Description" }]
                });
                $(".table").css({ "width": "100%" });
                $(".dataTables_scrollHeadInner ").css({ "width": "100%" });
            }
        });
    }

        function applyeventshow() {
            var $valid = $('#frm_eventcount').valid();
            if (!$valid) {
                $validatorform.focusInvalid();
                return false;
            } else {
                ipvalue = document.getElementById("ip").value;
                var systemvalue = document.getElementById('add_systemname').value;
                if (systemvalue == "") {
                    systemvalue = document.getElementById("system").value;
                }
                var url = '@Url.Content("~/csat_report/report_event_apply_show?ouid=")' + ouidvalue1 + '&system=' + systemvalue + '&ip=' + ipvalue;
                $.ajax({
                    type: "POST",
                    url: url,
                    success: function (data) {
                        var dataclear = document.getElementById('tblapplyshow_div');
                        dataclear.innerHTML = '&nbsp;';
                        $('#tblapplyshow_div').append("<table id='tblapplyshow' class='table table-striped table-bordered' width='100%'></table>");
                        otable = document.getElementById('tblapplyshow');
                        var data1 = [];
                        for (var i = 0; i < data.modemusagedata.length; i++) {
                            data1.push([data.modemusagedata[i].date_time, data.modemusagedata[i].ou_longname, data.modemusagedata[i].device_name, data.modemusagedata[i].ip]);
                        }
                        var otable = $("#tblapplyshow").DataTable({
                            data: data1, scrollX: !0, searching: !1, dom: "<'top'lB>rt<'bottom'ip><'clear'>", buttons: ["colvis", { text: "PDF", extend: "pdfHtml5", download: "open", filename: "Event Monitoring_" + today, orientation: "portrait", pageSize: "A4", exportOptions: { columns: ":visible", search: "applied", order: "applied" }, customize: function (t) { t.content.splice(0, 1); var e = new Date, n = e.getDate() + "-" + (e.getMonth() + 1) + "-" + e.getFullYear(); t.pageMargins = [20, 60, 20, 30], t.defaultStyle.fontSize = 7, t.styles.tableHeader.fontSize = 7, t.header = function () { return { columns: [{ margin: [0, -5, 30, 15], alignment: "left", width: 100, image: "data:image/png;base64," + pdflogo }, { margin: [-10, 10, 10, 0], alignment: "center", width: 410, text: "Event Monitoring Report", fontSize: 12 }, { alignment: "right", fontSize: 14, text: "" }], margin: 20 } }, t.footer = function (t, e) { return { columns: [{ alignment: "left", text: ["Created on: ", { text: n.toString() }] }, { alignment: "right", text: ["page ", { text: t.toString() }, " of ", { text: e.toString() }] }], margin: 20 } }; var a = { hLineWidth: function (t) { return .5 }, vLineWidth: function (t) { return .5 }, hLineColor: function (t) { return "#aaa" }, vLineColor: function (t) { return "#aaa" }, paddingLeft: function (t) { return 4 }, paddingRight: function (t) { return 4 } }; t.content[0].layout = a } }, 'excel'],
                            columns: [{ title: "Timestamp" }, { title: "Branch/ Unit" }, { title: "System Name" }, { title: "IP Address" }]
                        });
                        $(".table").css({ "width": "100%" });
                        $(".dataTables_scrollHeadInner ").css({ "width": "100%" });
                    }
                });
            }
        }

    function cleardata() {
        $('#tblapplyevent').html('');
        $('#tblapplyshow').html('');
        document.getElementById("system").value = '-1';
        document.getElementById("ip").value = '';
        document.getElementById("drpou1").value = '-1';
        ouidvalue1 = "";
        systemvalue = "";
        ipvalue = "";
    }
</script>
<script>
    //checkbox input hide & show
    $('#inputsystemname').hide();
    $('#add_system_chk').on('click', function () {
        if ($(this).is(':checked')) {
            $('#selectsys').hide();
            $('#inputsystemname').show();
        }
        else {
            $('#selectsys').show();
            $('#inputsystemname').hide();
            document.getElementById('add_systemname').value = "";
        }
    });
</script>
