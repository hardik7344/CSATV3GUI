
@{
    ViewData["Title"] = "report_autopower_off_status";
    Layout = "~/Views/Shared/ownyit_main_page.cshtml";
}

<script type="text/javascript">
    var now = new Date();
    var day = ("0" + now.getDate()).slice(-2);
    var month = ("0" + (now.getMonth() + 1)).slice(-2);
    var today = now.getFullYear() + "-" + (month) + "-" + (day);
</script>

<div class="row row_top_margin">
    <div class="col-sm-12 col-md-12 col-lg-12">
        <div class="ibox float-e-margins ">
            <div class="ibox-content" style="padding:4px;">
                <ul class="breadcrumb" style="margin-bottom:0px;">
                    <li>
                        @Html.ActionLink("Reports", "report_agent_information", "csat_report")
                        <i class="icon-angle-right"></i>
                    </li>
                    <li> Auto Power-off Status Report </li>
                </ul>
            </div>
        </div>
    </div>
    <!--side menu-->
    <div class="col-sm-2 col-md-2 col-lg-2 no_padding">
        <div class="ibox float-e-margins ">
            <div class="ibox-content sidemenu">
                @{
                    @Html.Partial("csat_report_menu");
                }
            </div>
        </div>
    </div>
    <!--side menu end-->

    <div class="col-sm-10 col-md-10 col-lg-10">

        <!--BackSide Generate white form color-->
        <div class="ibox float-e-margins" style="margin-bottom: 10px;">
            <div class="ibox-content">
                <div class="row">
                    <div class="col-sm-12 col-md-12 col-lg-12">
                        <div class="row">
                            <div class="col-xs-12">
                                <form class="form-horizontal" method="post">
                                    <div class="form-group">
                                        <label for="nameField" style="margin-top: -5px;background-color: #fff;text-align: center;color: #3D93C8;width: 120px;" class="col-xs-2 form_label">&nbsp;&nbsp;Advance Search&nbsp;&nbsp;</label>
                                        <div class="col-xs-10">
                                        </div>
                                    </div>

                                </form>
                            </div>
                        </div>
                    </div>
                </div>
                <!--BackSide Generate white form over-->

                <div class="row">
                    <div class="col-xs-12">
                        <form class="form-horizontal" method="post">
                            <div class="form-group">
                                <label for="nameField" class="col-xs-2 col-lg-1 col-md-1">Branch/ Unit</label>
                                <div class="col-xs-4">
                                    <select class="form-control col-sm-3 col-lg-3 col-md-3" name="Branch/Unit" id="DrpOU">
                                        @*<option>Root</option>
                                        <option value="01">Root >> Location</option>
                                        <option value="02">Root >> Location >> Department</option>*@
                                    </select>
                                </div>

                                <label for="nameField" class="col-xs-1 form_label">System Name</label>
                                <div class="col-xs-3">
                                    <select class="form-control col-sm-3 col-lg-3 col-md-3" name=" System" id="system">
                                        <option value="-1">Select System Name</option>
                                        @*<option>Upen-Pc</option>
                                        <option value="01">Ajay-Pc</option>
                                        <option value="02">Pankti-Pc</option>*@
                                    </select>
                                </div>

                                <label for="nameField" class="col-xs-1 form_label">IP Address</label>
                                <div class="col-xs-2">
                                    <input type="text" class="form-control col-sm-3 col-lg-3 col-md-3" placeholder="" name="ip" id="ip">
                                    @*<select class="form-control col-sm-3 col-lg-3 col-md-3" name="ip adrss" id="ip">
                                        <option value="-1">Select IP Address</option>                                       
                                    </select>*@
                                </div>
                            </div>

                            <div class="form-group">
                                <label for="nameField" class="col-xs-1 form_label">Date Range</label>
                                <div class="col-xs-4">
                                    <input type="text" name="datetime1" class="form-control" placeholder="DD/MM/YYYY -  DD/MM/YYYY " id="dateAutopower">
                                </div>
                                <div class="pull-left col-xs-1">
                                    <input type="button" class="btn btn-primary" value="Show" onclick="Funcautopwestatusinfo()">
                                </div>
                            </div>
                        </form>
                    </div>
                </div>


            </div>
        </div>
        <!--Auto Power-off status Datatable start-->

        <div class="row">

            <div class="col-sm-12 col-md-12 col-lg-12">

                <div class="table-responsive" id="tblrptautopower">

                </div>
            </div>
        </div>
    </div>
</div>
<div class="space_bottom">
    &nbsp;
</div>
<script>
    var startdate;
    var enddate;
    $(function () {
        $('input[name="datetime1"]').daterangepicker({
            autoUpdateInput: true,
            timePicker: true,
            timePickerSeconds: true,
            timePicker24Hour: true,
            startDate: moment().add(-24, 'hour'),
            endDate: moment(),
            locale: {
                cancelLabel: 'Clear',
                format: 'DD/MM/YYYY hh:mm:ss '
            }
        });

        $('input[name="datetime1"]').on('apply.daterangepicker', function (ev, picker) {
            startdate = picker.startDate.format('DD/MM/YYYY hh:mm:ss');
            enddate = picker.endDate.format('DD/MM/YYYY hh:mm:ss');
            $(this).val(picker.startDate.format('DD/MM/YYYY hh:mm:ss') + ' - ' + picker.endDate.format('DD/MM/YYYY hh:mm:ss'));
        });

        $('input[name="datetime1"]').on('cancel.daterangepicker', function (ev, picker) {
            $(this).val('');
        });
        $(window).bind('scroll', function () {
            $(".daterangepicker").hide();
        });
    });
</script>
<script>
    $.get('@Url.Content("~/csat_report/GetOU/")', null, DataBind)
    function DataBind(data) {
      //  debugger;
        var url = '@Url.Content("~/csat_report/GetOU/")';
        $.ajax({
            type: "POST",   
            url: url,
            success: function (data) {
        var SetData = $('#DrpOU');
        jQuery('#DrpOU').html('');
        var oudata = "<option value='-1'>Select Branch/ Unit</option>";
        for (var i = 0; i < data.ou.length; i++) {
            oudata += "<option value='" + data.ou[i].ouid + "'>" + data.ou[i].ouname + "</option>";
        }
        SetData.append(oudata);
            }
        });
    }
</script>
<script>
    var ouidvalue = "";
    var systemvalue = "";
    var ipvalue = "";
        $("#DrpOU").change(function () {
     //  debugger;
        ouidvalue = this.value;
        var url = '@Url.Content("~/csat_report/Get_syatemname_ip?ouid=")' + this.value;
        $.ajax({
            type: "POST",
            url: url,
            success: function (data) {
	//	debugger;
				 var SetDatadevice = $('#system');
				 //var SetDataip = $('#ip');
			  jQuery('#system').html('');
                //jQuery('#ip').html('');

		  var devicedata = "<option value='-1'>Select System Name</option>";
		 //var ipdata = "<option value='-1'>Select IP Address</option>";
      	    for (var i = 0; i < data.systemip.length; i++) {
				 devicedata+="<option value='"+ data.systemip[i].device_name +"'>"+ data.systemip[i].device_name +"</option>";
                    //ipdata+="<option value='"+ data.systemip[i].ip +"'>"+ data.systemip[i].ip +"</option>";
											}
                SetDatadevice.append(devicedata);
				//SetDataip.append(ipdata);
            }

            });

    });

    $("#system").change(function () {
        systemvalue = this.value;
    });
    //$("#ip").change(function () {
    //    ipvalue = this.value;
    //    //systemvalue= this.value;

    //});

    function Funcautopwestatusinfo() {
        var ipvalue = document.getElementById("ip").value;
        startdate = $('#dateAutopower').data('daterangepicker').startDate.format('DD/MM/YYYY hh:mm:ss');
        enddate = $('#dateAutopower').data('daterangepicker').endDate.format('DD/MM/YYYY hh:mm:ss');
        var url = '@Url.Content("~/csat_report/Get_autopowerstatus_Data?IP=")' + ipvalue + '&Device=' + systemvalue + '&ouid=' + ouidvalue + '&startdate=' + startdate + '&enddate=' + enddate;
        $.ajax({
            type: "POST",
            url: url,
            success: function (data) {
             //   debugger;
                jQuery('#tblrptautopower').html('');
                var Setautopowerinfo = $('#tblrptautopower');
                var autopowerheader = "<table class='table table-striped table-bordered tbl_pdfexport_date' id='auto_poweroff_status_datatable' style='width:100%'><thead><tr>";
                autopowerheader += "<th class='col-sm-1'>Branch/ Unit</th><th class='col-sm-1'>System Name</th>" +
                    "<th class='col-sm-1'>IP Address</th><th class='col-sm-1'>TimeStamp</th>" +
                    "<th class='col-sm-1'>Status/Action</th></tr ></thead > <tbody>";
                var autopowerrows = "";
                for (var i = 0; i < data.autopower_data.length; i++) {
                    autopowerrows += "<tr>";
                    autopowerrows += "<td class='col - sm - 1'>" + data.autopower_data[i].ou_longname + "</td>" +
                        "<td class='col - sm - 1'>" + data.autopower_data[i].device_name + "</td>" +
                        "<td class='col - sm - 1'>" + data.autopower_data[i].ip + "</td>" +
                        "<td class='col - sm - 1'>" + data.autopower_data[i].timestamp + "</td>" +
                        "<td class='col - sm - 1'>" + data.autopower_data[i].action + "</td>";
                }
                autopowerinfo = autopowerheader + autopowerrows + "</tr></tbody></table>";
                Setautopowerinfo.append(autopowerinfo);
                reportname = 'Auto Power-off Status Report';
                reportdate = document.getElementById('dateAutopower').value;
                datatable_pdfexport_date(reportname, reportdate);
               
            }
        });
    }
</script>

