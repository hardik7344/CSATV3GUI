
@{
    ViewData["Title"] = "report_employee_details";
    Layout = "~/Views/Shared/ownyit_main_page.cshtml";
}


<body onload="fn_emp_load()">
    <div class="row">
        <!--side menu-->
        <div class="ibox float-e-margins ">
            <div class="ibox-content" style="padding:4px;">
                <div class="pull-right form_label btn_top_margin">
                    <button class="btn btn-primary btn-md day " data-toggle="modal" data-target="#upload_file_popup">Upload File</button>
                </div>
                <ul class="breadcrumb" style="margin-bottom:0px;">
                    <li>
                        @Html.ActionLink("Reports", "report_employee_details", "csat_report")
                        <i class="icon-angle-right"></i>
                    </li>
                    <li> Employee Details  </li>
                </ul>
            </div>
        </div>
        <!--side menu end-->

        <div class="col-sm-2 col-md-2 col-lg-2 no_padding">
            <div class="ibox float-e-margins ">
                <div class="ibox-content sidemenu">
                    @{
                        @Html.Partial("csat_report_menu");
                    }
                </div>
            </div>
        </div>

        <div class="col-sm-10 col-md-10 col-lg-10">
            <!--form content start-->
            <div class="ibox float-e-margins" style="margin-bottom: 10px;">
                <div class="ibox-content">
                    <div class="row">
                        <div class="col-sm-12 col-md-12 col-lg-12">
                            <div class="row">
                                <div class="col-xs-12">
                                    <form class="form-horizontal" method="post">
                                        <div class="form-group">
                                            <label for="nameField" style="margin-top: -5px;background-color: #fff;text-align: center;color: #3D93C8;width: 120px;" class="col-xs-2 form_label">&nbsp;&nbsp;Advance Search&nbsp;&nbsp;</label>
                                            <div class="col-xs-10">
                                            </div>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-xs-12">
                            <form class="form-horizontal" method="post">
                                <div class="form-group">
                                    <label for="nameField" class="col-xs-2 form_label">Employee Name</label>
                                    <div class="col-xs-2">
                                        <select class="form-control col-sm-3 col-lg-3 col-md-3" name="emp_name" id="emp_name"></select>
                                    </div>
                                    <label for="nameField" class="col-xs-1 form_label">IP Address</label>
                                    <div class="col-xs-2">
                                        <select class="form-control col-sm-3 col-lg-3 col-md-3" name="ip" id="ip"></select>
                                    </div>
                                    <div class="pull-left col-xs-1">
                                        <input type="button" class="btn btn-primary" value="Show" id="btnshowreport" onclick="showemp_details()">
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
            <!--form  content end-->
            <!--employee details report Datatable start-->
            <div class="row ibox2">
                <div class="col-sm-12 col-md-12 col-lg-12 ibox2-content" id="emp_details_divclear">
                    <table id="tblemp_details" class="table table-striped table-bordered display nowrap" width="100%"></table>
                </div>
            </div>
            <!--employee details report Datatable end-->
        </div>
        <br />
    </div>

    <!--delete_employee device model  content-->
    <div class='modal fade ' id='delete_employee' tabindex='-1' role='dialog' aria-labelledby='myModalLabel' aria-hidden='true'>
        <div class='modal-dialog modal-small'>
            <div class='modal-content '>
                <div class='modal-header'>
                    <button type='button' class='close' data-dismiss='modal' aria-hidden='true'>&times;</button>
                    <h6 class='modal-title'>Conformation </h6>
                </div>
                <div class='modal-body'>
                    <!--form  content-->
                    <div class='row'>
                        <div class='col-sm-12 col-md-12 col-lg-12'>
                            <div class='row'>
                                <div class='col-xs-12'>
                                    <form class='form-horizontal' method='post'>
                                        <div class='form-group'>
                                            <label for='nameField' class='col-xs-12'>
                                                <i class='glyphicon glyphicon-exclamation-sign delete_msg'></i>
                                                <span style='font-weight:normal;margin-left:30px;'>Are you sure you want to delete this record?</span>
                                            </label>
                                        </div>
                                        <div class='form-group'>
                                            <label for='nameField' class='col-xs-4'></label>
                                            <div class='col-xs-6'>
                                                <input type='button' class='btn btn-primary' name='yes' value='Yes' id="btnempdelete" />
                                                <input type='button' class='btn btn-default' data-dismiss="modal" name='no' value='No' />
                                            </div>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>  <!--form  content end-->
                </div>
            </div><!-- /.modal-content -->
        </div><!-- /.modal-dialog -->
    </div><!-- /.modal -->
    <!-- delete_employee main node popup model box  Content-->
    <!-- upload file Data pop-up model box Content-->
    <div class="modal fade" id="upload_file_popup" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" data-backdrop="static" data-keyboard="false">
        <div class="modal-dialog  modal-small" style="margin-top: 82px;">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true" onclick="cleardata()">&times;</button>
                    <h6 class=" modal-title">
                        File Upload
                    </h6>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-sm-12 col-md-12 col-lg-12">
                            <!--form content-->
                            <div class="row">
                                <div class="col-xs-10">
                                    <form class="form-horizontal" method="post" enctype="multipart/form-data" id="upload_file_form">
                                        <div class="form-group">
                                            <label for="nameField" class="col-xs-3">Upload File</label>
                                            <div class="col-xs-9">
                                                <div class="input-group input-file" name="Attechment">
                                                    <input type="file" class="form-control" id="fileupload" placeholder='Choose a file...' style="margin-left: -20px;" />
                                                    @*<span class="input-group-btn">
                                                            <button class="btn btn-default btn-choose" type="button">Choose</button>
                                                        </span>*@
                                                </div>
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label for="nameField" class="col-xs-3"></label>
                                            <div class="pull-left col-xs-3">
                                                <input type="submit" class="btn btn-primary" value="Upload" id="btnuploadfile" style="margin-left: -20px;">
                                            </div>
                                        </div>
                                    </form>
                                </div>
                            </div>
                            <!--End form content-->
                        </div>
                    </div>
                </div>
            </div><!-- /.modal-content -->
        </div><!-- /.modal-dialog -->
    </div>
    <!-- End upload file pop-up model box Content -->

</body>

<script>
    function fn_emp_load() {
        var url = '@Url.Content("~/csat_report/GetEmployee/")';
        $.ajax({
            type: "POST",
            url: url,
            success: function (data) {
                var SetData = $('#emp_name');
                jQuery('#emp_name').html('');
                var empdata = "<option value='-1'>Select Employee</option>";
                for (var i = 0; i < data.emp.length; i++) {
                    empdata += "<option value='" + data.emp[i].employee_no + "'>" + data.emp[i].employee_name + "</option>";
                }
                SetData.append(empdata);

                var SetData = $('#ip');
                jQuery('#ip').html('');
                var ipdata = "<option value='-1'>Select IP Address</option>";
                for (var i = 0; i < data.emp.length; i++) {
                    if (data.emp[i].ip === "" || data.emp[i].ip === null) { }
                    else {
                        ipdata += "<option value='" + data.emp[i].ip + "'>" + data.emp[i].ip + "</option>";
                    }
                }
                SetData.append(ipdata);
            }
        });
    }
    var macaddress = "";
    var macaddressall = "";
    function showemp_details() {
        //$("#overlay").show();
        //$("#overlay").fadeIn(300);
        var empvalue = document.getElementById("emp_name").value;
        var ipvalue = document.getElementById("ip").value;
        var url = '@Url.Content("~/csat_report/GetEmployeeDetailsReport?Employee=")' + empvalue + '&IPAddress=' + ipvalue;
        $.ajax({
            type: "POST",
            url: url,
            success: function (data) {
                //debugger;
                var dataclear = document.getElementById('emp_details_divclear');
                dataclear.innerHTML = '&nbsp;';
                $('#emp_details_divclear').append("<table id='tblemp_details' class='table table-striped table-bordered' width='100%'></table><div class='col-xs-11 pull-left'><input type='button' class='btn btn-primary' style='margin-bottom:15px;margin-top: -20px; margin-left: -8px;' value='Delete' name='delete_emp' id='delete_emp' /></div>");
                otable = document.getElementById('tblemp_details');
                var data1 = [];
                for (var i = 0; i < data.emp_details.length; i++) {
                    if (data.emp_details[i].card_no == '0') { data.emp_details[i].card_no = ''; }
                    if (data.emp_details[i].employee_no == '0') { data.emp_details[i].employee_no = ''; }
                    if (data.emp_details[i].birth_date == '01-01-1900') { data.emp_details[i].birth_date = ''; }
                    if (data.emp_details[i].join_date == '01-01-1900') { data.emp_details[i].join_date = ''; }
                    if (data.emp_details[i].internal_phone == '0') { data.emp_details[i].internal_phone = ''; }
                    if (data.emp_details[i].mobile == '0') { data.emp_details[i].mobile = ''; }
                    if (data.emp_details[i].marriage_date == '01-01-1900') { data.emp_details[i].marriage_date = ''; }
                    if (data.emp_details[i].aadhar_no == '0') { data.emp_details[i].aadhar_no = ''; }
                    if (data.emp_details[i].pincode == '0') { data.emp_details[i].pincode = ''; }

                    //var delete_div = "<i class=' glyphicon glyphicon-trash manage_icon ' type='button' data-toggle='modal' title='Delete' onclick=deleteemp('" + data.emp_details[i].card_no + "')></i>";
                    data1.push([data.emp_details[i].mac_address, data.emp_details[i].mac_address, data.emp_details[i].device_status, data.emp_details[i].device_type, data.emp_details[i].card_no, data.emp_details[i].employee_no, data.emp_details[i].employee_name, data.emp_details[i].gender, data.emp_details[i].birth_date, data.emp_details[i].join_date, data.emp_details[i].designation, data.emp_details[i].department_section, data.emp_details[i].department, data.emp_details[i].location, data.emp_details[i].emailid, data.emp_details[i].dhcpd_ip, data.emp_details[i].internal_phone, data.emp_details[i].mobile, data.emp_details[i].blood_group, data.emp_details[i].marriage_date, data.emp_details[i].aadhar_no, data.emp_details[i].aadhar_name, data.emp_details[i].address1, data.emp_details[i].address2, data.emp_details[i].address3, data.emp_details[i].city, data.emp_details[i].pincode, data.emp_details[i].state]);
                }
                var otable = $("#tblemp_details").DataTable({
                    data: data1, scrollX: !0, searching: !1, dom: "<'top'lB>rt<'bottom'ip><'clear'>", buttons: ["colvis", { text: "PDF", extend: "pdfHtml5", download: "open", filename: "Employee Details Report_" + today, orientation: "portrait", pageSize: "A4", exportOptions: { columns: ":visible", search: "applied", order: "applied" }, customize: function (t) { t.content.splice(0, 1); var e = new Date, n = e.getDate() + "-" + (e.getMonth() + 1) + "-" + e.getFullYear(); t.pageMargins = [20, 60, 20, 30], t.defaultStyle.fontSize = 7, t.styles.tableHeader.fontSize = 7, t.header = function () { return { columns: [{ margin: [0, -5, 30, 15], alignment: "left", width: 100, image: "data:image/png;base64," + pdflogo }, { margin: [-10, 10, 10, 0], alignment: "center", width: 410, text: "Employee Details Report", fontSize: 12 }, { alignment: "right", fontSize: 14, text: "" }], margin: 20 } }, t.footer = function (t, e) { return { columns: [{ alignment: "left", text: ["Created on: ", { text: n.toString() }] }, { alignment: "right", text: ["page ", { text: t.toString() }, " of ", { text: e.toString() }] }], margin: 20 } }; var a = { hLineWidth: function (t) { return .5 }, vLineWidth: function (t) { return .5 }, hLineColor: function (t) { return "#aaa" }, vLineColor: function (t) { return "#aaa" }, paddingLeft: function (t) { return 4 }, paddingRight: function (t) { return 4 } }; t.content[0].layout = a } }, 'excel'],
                    'columnDefs': [{ 'targets': 0, 'checkboxes': { 'selectRow': true } }, { orderable: false, targets: 1 }], 'select': { 'style': 'multi' }, 'order': [[3, 'asc']],
                    columns: [{ title: "", width: '10px' }, { title: "MAC Address" }, { title: "Device Status" }, { title: "Device Type" }, { title: "Card No" }, { title: "Employee No" }, { title: "Employee Name" }, { title: "Gender" }, { title: "Birth Date" }, { title: "Join Date" }, { title: "Designation" }, { title: "Department Section" }, { title: "Department" }, { title: "Location" }, { title: "Email ID" }, { title: "DHCPD IP" }, { title: "Internal Phone" }, { title: "Mobile" }, { title: "Blood Group" }, { title: "Marriage Date" }, { title: "Aadhar No" }, { title: "Aadhar Name" }, { title: "Address1" }, { title: "Address2" }, { title: "Address3" }, { title: "City" }, { title: "Pincode" }, { title: "State" }]
                });
                $(".table").css({ "width": "100%" });
                $(".dataTables_scrollHeadInner ").css({ "width": "100%" });

               $('#delete_emp').on('click', function (e) {
                    //debugger;
                    var form = this;
                    var rows_selected = otable.column(0).checkboxes.selected();
                    $.each(rows_selected, function (index) {
                        macaddressall = ""; 
                        for (var i = 0; i < rows_selected.length; i++) {
                            macaddressall += "','" + rows_selected[i];
                        }
                        deleteemp(macaddressall);
                        return false;
                    });
                    if (macaddressall == "") { deleteemp(macaddressall) }
               });
            }
        }).done(function () {
            setTimeout(function () {
                $("#overlay").fadeOut(300);
            }, 500);
        });
    }
    var mac_addressall = "";
    function deleteemp(macaddressall) {
        mac_addressall = macaddressall;
        $('#delete_employee').modal('show');
    }
    $('#btnempdelete').on('click', function () {
        var url1 = '@Url.Content("~/csat_report/DeleteEmployee?mac_address=")' + mac_addressall;
        $.ajax({
            type: "POST",
            url: url1,
            success: function (result) {
                alert(result);
                $('#delete_employee').modal('hide');
                showemp_details();
                fn_emp_load();
		    }
		});
    });
    $(function () {
        $("#upload_file_form").on('submit', function (e) {
            //debugger;
            e.preventDefault();
            var data = new FormData();
            data.append("formFile", $("#fileupload")[0].files[0]);
            $.ajax({
                type: "POST",
                url: '@Url.Content("~/csat_report/Employee_file_upload")',
                data: data,
                processData: false,
                contentType: false
            }).done(function (result) {
                if (result == "File uploaded successfully") {
                    alert("File uploaded successfully");
                    document.getElementById("fileupload").value = '';
                    $('#upload_file_popup').modal('hide');
                }
                else {
                    alert(result);
                }
                fn_emp_load();
            });
        });
    });
    function cleardata() {
        document.getElementById("fileupload").value = '';
        $('#upload_file_popup').modal('hide');
        $('#delete_employee').modal('hide');
        fn_emp_load();
    }
</script>

