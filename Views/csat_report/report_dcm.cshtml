
@{
    ViewData["Title"] = "report_dcm";
    Layout = "~/Views/Shared/ownyit_main_page.cshtml";
}

 <script type="text/javascript">
        $(function () {
            $('input[name="datefilter"]').daterangepicker({
                // opens: 'left',
                autoUpdateInput: true,
                startDate: moment().startOf('hour').add(-24, 'hour'),
                endDate: moment().startOf('hour'),
                locale: {
                    format: 'DD/MM/YYYY',
                    cancelLabel: 'Clear',

                }
            });

            $('input[name="datefilter"]').on('apply.daterangepicker', function (ev, picker) {
                $(this).val(picker.startDate.format('DD/MM/YYYY') + ' - ' + picker.endDate.format('DD/MM/YYYY '));
            });

            $('input[name="datefilter"]').on('cancel.daterangepicker', function (ev, picker) {
                $(this).val('');
            });
            $(window).bind('scroll', function () {
                $(".daterangepicker").hide();
            });

        });
    </script>

 <div class="row row_top_margin">
     <div class="col-sm-12 col-md-12 col-lg-12">
         <div class="ibox float-e-margins ">
             <div class="ibox-content" style="padding:4px;">
                 <ul class="breadcrumb" style="margin-bottom:0px;">
                     <li>
                         @Html.ActionLink("Reports", "report_agent_information", "csat_report")
                         <i class="icon-angle-right"></i>
                     </li>
                     <li> Non Compliance System List </li>
                 </ul>
             </div>
         </div>
     </div>

     <!--side menu-->
     <div class="col-sm-2 col-md-2 col-lg-2 no_padding">
         <div class="ibox float-e-margins ">
             <div class="ibox-content sidemenu">
                 @{
                     @Html.Partial("csat_report_menu");
                 }
             </div>
         </div>
     </div>
     <!--side menu end-->

     <div class="col-sm-10 col-md-10 col-lg-10">

         <div class="ibox float-e-margins" style="margin-bottom: 10px;">
             <div class="ibox-content">
                 <div class="row">
                     <div class="col-sm-12 col-md-12 col-lg-12">
                         <div class="row">
                             <div class="col-xs-12">
                                 <form class="form-horizontal" method="post">
                                     <div class="form-group">
                                         <label for="nameField" style="margin-top: -5px;background-color: #fff;text-align: center;color: #3D93C8;width: 120px;" class="col-xs-2 form_label">&nbsp;&nbsp;Advance Search&nbsp;&nbsp;</label>
                                         <div class="col-xs-10">
                                         </div>
                                     </div>
                                 </form>
                             </div>
                         </div>
                     </div>
                 </div>
                 <div class="row">
                     <div class="col-sm-12 col-md-12 col-lg-12">
                         <div class="row">
                             <div class="col-xs-12">
                                 <form class="form-horizontal" method="post">
                                     <div class="form-group">
                                         <label for="nameField" class="col-xs-1  form_label">Branch/ Unit</label>
                                         <div class="col-xs-4">
                                             <select class="form-control col-sm-3 col-lg-3 col-md-3" name="Branch/Unit" id="drpou">
                                                 <option value='-1'>Select Branch/ Unit</option>
                                             </select>
                                         </div>
                                         <label for="nameField" class="col-xs-1 form_label">System Name</label>
                                         <div class="col-xs-3">
                                             <select class="form-control col-sm-3 col-lg-3 col-md-3" name="Device" id="drpDevice">
                                                 <option value='-1'>Select System Name</option>
                                             </select>
                                         </div>
                                         <label for="nameField" class="col-xs-1 form_label">IP Address</label>
                                         <div class="col-xs-2">
                                             <input type="text" class="form-control col-sm-3 col-lg-3 col-md-3" placeholder="" name="ip" id="drpip">
                                             @*<select class="form-control col-sm-3 col-lg-3 col-md-3" name="ip" id="drpip">
                                                 <option value='-1'>Select IP Address</option>
                                             </select>*@
                                         </div>
                                     </div>


                                     <div class="form-group">

                                         <label for="nameField" class="col-xs-1 form_label">Date Range</label>
                                         <div class="col-xs-3">
                                             <input type="text" name="datefilter" class="form-control" placeholder="DD/MM/YYYY -  DD/MM/YYYY " id="dcm_date">
                                         </div>
                                         <label for="nameField" class="col-xs-1 form_label">System Type</label>
                                         <div class="col-xs-2">
                                             <select class="form-control col-sm-2 col-lg-2 col-md-2" name="type" id="stype">
                                                 <option value="">Select System Type</option>
                                                 <option value="0">Managed</option>
                                                 <option value="1">Unmanaged</option>
                                             </select>
                                         </div>

                                         <div class="pull-left col-xs-1">
                                             <input type="button" class="btn btn-primary" value="Show" id="btnshowreport">
                                         </div>
                                     </div>

                                 </form>

                             </div>
                         </div>
                     </div>

                 </div>

                 <!--form  content end-->
                 <!--Non Compliance System List   form end-->
             </div>
         </div>
         <!--Non Compliance System List  Datatable start-->
         <div class="row">
             <div class="col-sm-12 col-md-12 col-lg-12">
                 <div class="table-responsive" id="divdcm">

                 </div>
             </div>
         </div>
         <!--Non Compliance System List  Datatable end-->
         <div class="space_bottom">&nbsp;</div>
     </div>
 </div>
<script>
 $.get('@Url.Content("~/csat_report/GetOU/")', null, DataBind)
    function DataBind(data) {

       // debugger;
        var url = '@Url.Content("~/csat_report/GetOU/")';
        $.ajax({
            type: "POST",   
            url: url,
            success: function (data) {
        var SetData = $('#drpou');
        jQuery('#drpou').html('');
        
        var oudata = "<option value='-1'>Select Branch/ Unit</option>";
        for (var i = 0; i < data.ou.length; i++) {
            oudata += "<option value='" + data.ou[i].ouid + "'>" + data.ou[i].ouname + "</option>";
        }
        SetData.append(oudata);
            }
        });
    }
	
    

$("#drpou").change(function () {

        ouidvalue = this.value;
        var url = '@Url.Content("~/csat_report/Get_syatemname_ip?ouid=")' + this.value;
        $.ajax({
        type: "POST",
        url: url,
        success: function (data) {
        // debugger;
        var SetDatadevice = $('#drpDevice');
        //var SetDataip = $('#drpip');
        
        jQuery('#drpDevice').html('');
        //jQuery('#drpip').html('');
       
        var devicedata = "<option value='-1'>Select System Name</option>";
        //var ipdata = "<option value='-1'>Select IP Address</option>";
       
        for (var i = 0; i < data.systemip.length; i++) {
           devicedata+="<option value='"+ data.systemip[i].device_name +"'>"+ data.systemip[i].device_name +"</option>";
           //ipdata+="<option value='"+ data.systemip[i].ip +"'>"+ data.systemip[i].ip +"</option>";
            }
            
            SetDatadevice.append(devicedata);
            //SetDataip.append(ipdata);
            
        }

        });

    });
	var ouidvalue="";
    var systemvalue="";
    var ipvalue = "";
    $("#drpou").change(function () {
        ouidvalue = this.value;
    });

    $("#drpDevice").change(function () {
        systemvalue = this.value;

    });
    //$("#drpip").change(function () {
    //    ipvalue = this.value;

    //});
	var sdate="";
	var edate="";
	  $(function () {
            $('input[name="datefilter"]').daterangepicker({
                // opens: 'left',
                autoUpdateInput: true,
                startDate: moment().startOf('hour').add(-24, 'hour'),
                endDate: moment().startOf('hour'),
                locale: {
                    format: 'DD/MM/YYYY',
                    cancelLabel: 'Clear',

                }
            });

            $('input[name="datefilter"]').on('apply.daterangepicker', function (ev, picker) {
                $(this).val(picker.startDate.format('DD/MM/YYYY') + ' - ' + picker.endDate.format('DD/MM/YYYY '));
					sdate=picker.startDate.format('DD/MM/YYYY');
	                edate=picker.endDate.format('DD/MM/YYYY');
            });

            $('input[name="datefilter"]').on('cancel.daterangepicker', function (ev, picker) {
                $(this).val('');
            });


        });

		$('#btnshowreport').on('click',function()
        {
            sdate = $('#dcm_date').data('daterangepicker').startDate.format('DD/MM/YYYY');
            edate = $('#dcm_date').data('daterangepicker').endDate.format('DD/MM/YYYY');
		 // debugger;
         var search= document.getElementById("stype").value;
            var ipvalue = document.getElementById("drpip").value;
	   $.ajax({
	    type : "POST",
	    url : '@Url.Content("~/csat_report/getDCMdata?serch=")'+search+'&startdate='+sdate+'&enddate='+edate+'&ouid='+ouidvalue+'&ip='+ipvalue+'&device='+systemvalue,
	    success : function(data)
	     {
	    // debugger;
	         var Setgriddata = $('#divdcm');
			  jQuery('#divdcm').html('');

            var headdata = "<table class='table table-striped table-bordered tblpdfexport' style='width:100%'><thead><tr><th class='col-sm-2'>Branch/ Unit</th>"+
                             "<th class='col-sm-1'>System Name</th><th class='col-sm-1'>IP Address</th><th class='col-sm-1'>System Type</th><th class='col-sm-4'>Details</th></tr></thead><tbody>";			
			   var trdata="";
			   for (var i = 0; i < data.getdcm.length; i++) {
			   trdata+="<tr>";
                   trdata += "<td class='col-sm-2'>" + data.getdcm[i].ou_longname+"</td>";
			   trdata+="<td class='col-sm-1'>"+data.getdcm[i].device_name+"</td>";
			   trdata+="<td class='col-sm-1'>"+data.getdcm[i].ip+"</td>";
			   trdata+="<td class='col-sm-1'>"+data.getdcm[i].device_type+"</td>";
			   trdata+="<td class='col-sm-4'>"+data.getdcm[i].reason+"</td>";
			   trdata+="</tr>";
               }
                Setgriddata.append(headdata+trdata+"</tbody></table>");
                reportname = "Non Compliance System List Report";
                datatable_pdfexport(reportname);
	      }

    	 });
		
		});
	</script>

