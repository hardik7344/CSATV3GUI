
@{
    ViewData["Title"] = "report_usb_history";
    Layout = "~/Views/Shared/ownyit_main_page.cshtml";
}
<body onload="DataBind();">
    <script type="text/javascript">
        var startdate = "";
        var enddate = "";
        $(function () {
            $('input[name="datefilter"]').daterangepicker({
                // opens: 'left',
                autoUpdateInput: true,
                startDate: moment().startOf('hour').add(-24, 'hour'),
                endDate: moment().startOf('hour'),
                locale: {
                    format: 'DD/MM/YYYY',
                    cancelLabel: 'Clear',

                }
            });

            $('input[name="datefilter"]').on('apply.daterangepicker', function (ev, picker) {
                startdate = picker.startDate.format('DD/MM/YYYY');
                enddate = picker.endDate.format('DD/MM/YYYY');
                $(this).val(picker.startDate.format('DD/MM/YYYY') + ' - ' + picker.endDate.format('DD/MM/YYYY '));
            });

            $('input[name="datefilter"]').on('cancel.daterangepicker', function (ev, picker) {
                $(this).val('');
            });
            $(window).bind('scroll', function () {
                $(".daterangepicker").hide();
            });

        });
    </script>

    <div class="row">
        <!--side menu-->
        <div class="ibox float-e-margins ">
            <div class="ibox-content" style="padding:4px;">
                <ul class="breadcrumb" style="margin-bottom:0px;">
                    <li>
                        @Html.ActionLink("Reports", "report_usb_history", "csat_report")
                        <i class="icon-angle-right"></i>
                    </li>
                    <li> USB History  </li>
                </ul>
            </div>
        </div>

        <!--side menu end-->
        @*<div class="row">*@

        <div class="col-sm-2 col-md-2 col-lg-2 no_padding">
            <div class="ibox float-e-margins ">
                <div class="ibox-content sidemenu">
                    @{
                        @Html.Partial("csat_report_menu");
                    }
                </div>
            </div>
        </div>
        <div class="col-sm-10 col-md-10 col-lg-10">
            <div class="ibox float-e-margins" style="margin-bottom: 10px;">
                <div class="ibox-content">
                    <div class="row">
                        <div class="col-sm-12 col-md-12 col-lg-12">

                            <div class="row">
                                <div class="col-xs-12">
                                    <form class="form-horizontal" method="post">
                                        <div class="form-group">
                                            <label for="nameField" style="margin-top: -5px;background-color: #fff;text-align: center;color: #3D93C8;width: 120px;" class="col-xs-2 form_label">&nbsp;&nbsp;Advance Search&nbsp;&nbsp;</label>
                                            <div class="col-xs-10">
                                            </div>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-xs-12">
                            <form class="form-horizontal" method="post" name="frm_usbhistory_report" id="frm_usbhistory_report">
                                <div class="form-group">
                                    <label for="nameField" class="col-xs-1  form_label">Branch/ Unit</label>
                                    <div class="col-xs-4">
                                        <select class="form-control col-sm-3 col-lg-3 col-md-3" name="Branch/Unit" id="DrpOU"></select>
                                    </div>
                                    <label for="nameField" class="col-xs-1 form_label">System Name</label>
                                    <div class="col-xs-2" id="selectsys">
                                        <select class="form-control col-sm-3 col-lg-3 col-md-3" name="Device" id="system">
                                            <option value="-1">Select System Name</option>
                                        </select>
                                    </div>
                                    <div class="col-xs-2" id="inputsystemname">
                                        <input type="text" class="form-control col-sm-3 col-lg-3 col-md-3" name="add_systemname" id="add_systemname">
                                    </div>
                                    <div class="col-xs-1">
                                        <input type="checkbox" class="form-check-input" id="add_system_chk" name="add_system_chk" style="width:20px;height:25px;">
                                    </div>
                                    <label for="nameField" class="col-xs-1 form_label" style="margin-left:-48px;">IP Address</label>
                                    <div class="col-xs-2">
                                        <input type="text" class="form-control col-sm-3 col-lg-3 col-md-3" placeholder="" name="ip" id="ip">
                                        @*<select class="form-control col-sm-3 col-lg-3 col-md-3" name="ip" id="ip">
                                                <option value="-1">Select IP Address</option>
                                            </select>*@
                                    </div>
                                </div>
                                <div class="form-group">
                                    @*<label for="nameField" class="col-xs-1 form_label">Date-Range</label>
                                        <div class="col-xs-4">
                                            <input type="text" name="datefilter" class="form-control" placeholder="DD/MM/YYYY - DD/MM/YYYY " id="date">
                                        </div>*@
                                    <label for="nameField" class="col-xs-1 ">Search</label>
                                    <div class="col-xs-2">
                                        <select class="form-control col-sm-2 col-lg-2 col-md-2" name="type" id="type">
                                            <option>Select Type</option>
                                            @*<option value="uh.description">USB Device Name</option>
                                                <option value="device_type">Device Type</option>
                                                <option value="connected">Connected</option>
                                                <option value="safe_to_unplug">Unplag</option>
                                                <option value="disabled">Disabled</option>
                                                <option value="computer_name">Computer Name</option>
                                                <option value="service_name">Service Name</option>
                                                <option value="device_mfg">Device Manufacture</option>*@
                                            <option value="uh.address">Address</option>
                                            <option value="uh.Capabilities">Capabilities</option>
                                            <option value="uh.ClassGUID">Class GUID</option>
                                            <option value="uh.CompatibleIDs">Compatible IDs</option>
                                            <option value="uh.ContainerID">Container ID</option>
                                            <option value="uh.DeviceDesc">Device Desc</option>
                                            <option value="uh.Driver">Driver</option>
                                            <option value="uh.FriendlyName">Friendly Name</option>
                                            <option value="uh.HardwareID">Hardware ID</option>
                                        </select>
                                    </div>
                                    <div class="col-xs-3">
                                        <div class="input-group">
                                            <input type="search" class="form-control" placeholder="Search" id="searchvalue" name="searchvalue" autocomplete="off">
                                            <div class="input-group-btn">
                                                <button class="btn btn-default" type="button" onclick="usbhistory()">
                                                    <i class="glyphicon glyphicon-search"></i>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="pull-left col-xs-1">
                                        <input type="button" class="btn btn-primary" value="Show" id="btnshowreport" onclick="usbhistory()">
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
            <!--form  content end-->
            <!--agent report form end-->
            <!--agent report Datatable start-->
            <div class="row ibox2">
                <div class="col-sm-12 col-md-12 col-lg-12 ibox2-content" id="tblusbhistory_div">
                    <table id="tblusbhistory" class="table table-striped table-bordered display nowrap"></table>
                </div>
            </div>
        </div>
    </div>
    <script>
        $(document).ready(function () {
            validateSingleForm("#frm_usbhistory_report");
        });
    </script>
    <script>

    //$.get('@Url.Content("~/csat_report/GetOU/")', null, DataBind);
    @*function DataBind(data) {
        $("#overlay").show();
        $("#overlay").fadeIn(300);
        //debugger;
        var url = '@Url.Content("~/csat_report/GetOU/")';
        $.ajax({
            type: "POST",
            url: url,
            success: function (data) {
                var SetData = $('#DrpOU');
                jQuery('#DrpOU').html('');
                var oudata = "<option value='-1'>Select Branch/ Unit</option>";
                for (var i = 0; i < data.ou.length; i++) {
                    oudata += "<option value='" + data.ou[i].ouid + "'>" + data.ou[i].ouname + "</option>";
                }
                SetData.append(oudata);
            }
        }).done(function () {
            setTimeout(function () {
                $("#overlay").fadeOut(300);
            }, 500);
        });
	}*@
        function DataBind() {
        $("#overlay").show();
        $("#overlay").fadeIn(300);
        //debugger;
        var url = '@Url.Content("~/csat_report/GetOU/")';
        $.ajax({
            type: "POST",
            url: url,
            success: function (data) {
                var SetData = $('#DrpOU');
                jQuery('#DrpOU').html('');
                var oudata = "<option value='-1'>Select Branch/ Unit</option>";
                for (var i = 0; i < data.ou.length; i++) {
                    oudata += "<option value='" + data.ou[i].ouid + "'>" + data.ou[i].ouname + "</option>";
                }
                SetData.append(oudata);
            }
        }).done(function () {
            setTimeout(function () {
                $("#overlay").fadeOut(300);
            }, 500);
        });
	}
    </script>
    <script>
    var ouidvalue="";
    var systemvalue="";
    var ipvalue = "";

    $("#DrpOU").change(function () {
     //  debugger;
        ouidvalue = this.value;
        var url = '@Url.Content("~/csat_report/Get_syatemname_ip?ouid=")' + this.value;
        $.ajax({
            type: "POST",
            url: url,
            success: function (data) {
			    //debugger;
				var SetDatadevice = $('#system');
				//var SetDataip = $('#ip');
			    jQuery('#system').html('');
                //jQuery('#ip').html('');

		        var devicedata = "<option value='-1'>Select System Name</option>";
		        //var ipdata = "<option value='-1'>Select IP Address</option>";
      	        for (var i = 0; i < data.systemip.length; i++) {
				    devicedata+="<option value='"+ data.systemip[i].device_name +"'>"+ data.systemip[i].device_name +"</option>";
                    //ipdata+="<option value='"+ data.systemip[i].ip +"'>"+ data.systemip[i].ip +"</option>";
				}
                SetDatadevice.append(devicedata);
				//SetDataip.append(ipdata);
            }
        });
    });
    </script>
    <script>
        $("#system").change(function () {
            systemvalue = this.value;
        });
        //$("#ip").change(function () {
        //    ipvalue = this.value;
        //});
        var type = "";
        $("#type").change(function () {
            //debugger;
            type = this.value;
        });
    </script>
    <script>
        function usbhistory() {
        var $valid = $('#frm_usbhistory_report').valid();
        if (!$valid) {
            $validatorform.focusInvalid();
            return false;
        } else {
            $("#overlay").show();
            $("#overlay").fadeIn(300);
            //var startdate = $('#date').data('daterangepicker').startDate.format('DD/MM/YYYY');
            //var enddate = $('#date').data('daterangepicker').endDate.format('DD/MM/YYYY');
            ipvalue = document.getElementById("ip").value;
            type = document.getElementById("type").value;
            var ValueSerach = document.getElementById("searchvalue").value;
            var systemvalue = document.getElementById('add_systemname').value;
            if (systemvalue == "") {
                systemvalue = document.getElementById("system").value;
            }
            var url = '@Url.Content("~/csat_report/USBHistoryReport?ip=")' + ipvalue + '&system=' + systemvalue + '&ouid=' + ouidvalue + '&FieldSerach=' + type + '&ValueSerach=' + ValueSerach;
            $.ajax({
                type: "POST",
                url: url,
                success: function (data) {
                    var tblusbhistory_div = document.getElementById('tblusbhistory_div');
                    tblusbhistory_div.innerHTML = '&nbsp;';
                    $('#tblusbhistory_div').append("<table id='tblusbhistory' class='table table-striped table-bordered' width='100%'></table>");
                    otable = document.getElementById('tblusbhistory');
                    var data1 = [];
                    //for (var i = 0; i < data.usbhistorydata.length; i++) {
                    //    data1.push([data.usbhistorydata[i].ou_longname, data.usbhistorydata[i].device_name, data.usbhistorydata[i].ip, data.usbhistorydata[i].usb_device_name, data.usbhistorydata[i].device_type, data.usbhistorydata[i].created_date, data.usbhistorydata[i].connected, data.usbhistorydata[i].safe_to_unplug, data.usbhistorydata[i].disabled, data.usbhistorydata[i].usb_hub, data.usbhistorydata[i].drive_letter, data.usbhistorydata[i].serial_number, data.usbhistorydata[i].vendorid, data.usbhistorydata[i].productid, data.usbhistorydata[i].computer_name, data.usbhistorydata[i].service_name, data.usbhistorydata[i].device_mfg, data.usbhistorydata[i].friendly_name, data.usbhistorydata[i].usb_version, data.usbhistorydata[i].driver_description, data.usbhistorydata[i].driver_version, data.usbhistorydata[i].instance_id, data.usbhistorydata[i].description]);
                    //}
                    //var otable = $("#tblusbhistory").DataTable({
                    //    data: data1, scrollX: !0, searching: !1, dom: "<'top'lB>rt<'bottom'ip><'clear'>", buttons: ["colvis", { text: "PDF", extend: "pdfHtml5", download: "open", filename: "USB History_" + today, orientation: "portrait", pageSize: "A4", exportOptions: { columns: ":visible", search: "applied", order: "applied" }, customize: function (t) { t.content.splice(0, 1); var e = new Date, n = e.getDate() + "-" + (e.getMonth() + 1) + "-" + e.getFullYear(); t.pageMargins = [20, 60, 20, 30], t.defaultStyle.fontSize = 7, t.styles.tableHeader.fontSize = 7, t.header = function () { return { columns: [{ margin: [0, -5, 30, 15], alignment: "left", width: 100, image: "data:image/png;base64," + pdflogo }, { margin: [-10, 10, 10, 0], alignment: "center", width: 410, text: "USB History Report", fontSize: 12 }, { alignment: "right", fontSize: 14, text: "" }], margin: 20 } }, t.footer = function (t, e) { return { columns: [{ alignment: "left", text: ["Created on: ", { text: n.toString() }] }, { alignment: "right", text: ["page ", { text: t.toString() }, " of ", { text: e.toString() }] }], margin: 20 } }; var a = { hLineWidth: function (t) { return .5 }, vLineWidth: function (t) { return .5 }, hLineColor: function (t) { return "#aaa" }, vLineColor: function (t) { return "#aaa" }, paddingLeft: function (t) { return 4 }, paddingRight: function (t) { return 4 } }; t.content[0].layout = a } }, 'excel'],
                    //    columns: [{ title: "Branch/ Unit" }, { title: "System Name" }, { title: "IP Address" }, { title: "USB Device Name" }, { title: "Device Type" }, { title: "Date" }, { title: "Connected" }, { title: "Unplug" }, { title: "Disabled" }, { title: "USB Hub" }, { title: "Drive Letter" }, { title: "Serial Number" }, { title: "Vendor ID" }, { title: "Product ID" }, { title: "Computer Name" }, { title: "Service Name" }, { title: "Device Manufacture" }, { title: "Friendly Name" }, { title: "USB Version" }, { title: "Driver Description" }, { title: "Driver Version" }, { title: "Instance ID" }, { title: "Description" }]
                    //});

                    for (var i = 0; i < data.usbhistorydata.length; i++) {
                        data1.push([data.usbhistorydata[i].ou_longname, data.usbhistorydata[i].device_name, data.usbhistorydata[i].ip, data.usbhistorydata[i].address, data.usbhistorydata[i].capabilities, data.usbhistorydata[i].classGUID, data.usbhistorydata[i].compatibleIDs, data.usbhistorydata[i].containerID, data.usbhistorydata[i].deviceDesc, data.usbhistorydata[i].driver, data.usbhistorydata[i].friendlyName, data.usbhistorydata[i].hardwareID]);
                    }
                    var otable = $("#tblusbhistory").DataTable({
                        data: data1, scrollX: !0, searching: !1, dom: "<'top'lB>rt<'bottom'ip><'clear'>", buttons: ["colvis", { text: "PDF", extend: "pdfHtml5", download: "open", filename: "USB History_" + today, orientation: "portrait", pageSize: "A4", exportOptions: { columns: ":visible", search: "applied", order: "applied" }, customize: function (t) { t.content.splice(0, 1); var e = new Date, n = e.getDate() + "-" + (e.getMonth() + 1) + "-" + e.getFullYear(); t.pageMargins = [20, 60, 20, 30], t.defaultStyle.fontSize = 7, t.styles.tableHeader.fontSize = 7, t.header = function () { return { columns: [{ margin: [0, -5, 30, 15], alignment: "left", width: 100, image: "data:image/png;base64," + pdflogo }, { margin: [-10, 10, 10, 0], alignment: "center", width: 410, text: "USB History Report", fontSize: 12 }, { alignment: "right", fontSize: 14, text: "" }], margin: 20 } }, t.footer = function (t, e) { return { columns: [{ alignment: "left", text: ["Created on: ", { text: n.toString() }] }, { alignment: "right", text: ["page ", { text: t.toString() }, " of ", { text: e.toString() }] }], margin: 20 } }; var a = { hLineWidth: function (t) { return .5 }, vLineWidth: function (t) { return .5 }, hLineColor: function (t) { return "#aaa" }, vLineColor: function (t) { return "#aaa" }, paddingLeft: function (t) { return 4 }, paddingRight: function (t) { return 4 } }; t.content[0].layout = a } }, 'excel'],
                        columns: [{ title: "Branch/ Unit" }, { title: "System Name" }, { title: "IP Address" }, { title: "Address" }, { title: "Capabilities" }, { title: "Class GUID" }, { title: "Compatible IDs" }, { title: "Container ID" }, { title: "Device Desc" }, { title: "Driver" }, { title: "Friendly Name" }, { title: "Hardware ID" }]
                    });

                    $(".table").css({ "width": "100%" });
                    $(".dataTables_scrollHeadInner ").css({ "width": "100%" });
                }
            }).done(function () {
                setTimeout(function () {
                    $("#overlay").fadeOut(300);
                }, 500);
            });
        }
    };
    </script>
    <script>
        //checkbox input hide & show
        $('#inputsystemname').hide();
        $('#add_system_chk').on('click', function () {
            if ($(this).is(':checked')) {
                $('#selectsys').hide();
                $('#inputsystemname').show();
            }
            else {
                $('#selectsys').show();
                $('#inputsystemname').hide();
                document.getElementById('add_systemname').value = "";
            }
        });
    </script>
</body>
